import{Q as Dn,i as qt,h as Nn,k as Fn,l as Mn,q as A,m as se,n as I,p as ve,j as t,P as Cn,o as P,T as d,t as M,v as N,w as x,W as G,x as Pe,y as Ee,z as U,D as ne,A as ie,B as Z,C as De,E as Ne,G as ye,H as E,I as z,J as X,K as O,L as Fe,M as be,O as te,S as J,V as K,X as dt,r as f,Y as B,Z as ns,_ as ue,$ as L,a0 as rs,a1 as we,a2 as me,a3 as ut,a4 as fe,a5 as _,u as Me,a6 as Ze,a7 as An,a8 as as,a9 as Tn,aa as Ln,ab as mt,ac as Se,ad as is,ae as os,af as ft,c as _t,ag as Rn,ah as Be,ai as ls,aj as cs,ak as it,al as ae,am as ds,an as $t,ao as Ot,ap as zn,aq as qn,ar as Ue,as as he,at as Xe,au as _n,av as $n,aw as On,ax as We,ay as Je,az as Kn,aA as Ce,aB as Ae,aC as de,aD as Bn,aE as Un,aF as Wn,aG as Ve,aH as us,R as Vn,aI as Kt,aJ as Ke,aK as ht,aL as et,aM as Te,aN as xt,aO as Le,aP as Qn,aQ as Hn,aR as Yn,aS as pt,aT as ms,aU as ot,aV as Gn,aW as Zn,aX as Xn,aY as Jn,aZ as er,a_ as tr,a$ as sr,b0 as fs,b1 as gt,b2 as nr,b3 as hs,b4 as xs,N as rr,b5 as ar,b6 as ir,b7 as or,b8 as lr}from"./main-4c909cbe.js";import{S as cr,G as dr,P as ps,A as ur,B as mr,F as Qe,a as gs,U as fr,D as vs,C as vt,R as hr,b as xr,c as pr,d as gr,e as vr,f as jr,g as yr,h as br,i as wr,j as Bt,k as Sr,V as kr,l as Ir,I as Pr,m as Er}from"./GridView-cebcb144.js";import{C as js,A as jt,D as yt,u as tt,a as ys,h as bs,F as Dr,b as _e,c as $e,d as Nr,e as Fr,f as oe,g as Mr,i as ws,j as Ss,k as Cr,l as Ut,L as Ar,m as ks,n as He,o as Ye,M as bt,T as wt,p as St,q as Is,r as Tr,s as Lr,t as Rr,v as zr,w as Ps,x as qr,y as _r,z as Es,B as Wt,I as $r,E as Ds,G as Ns,H as Vt,J as Fs,K as Ms,N as Or}from"./dashboard-layout-4cca3abb.js";import{S as Kr,E as Br,B as kt,a as Ie,C as Ur}from"./breadcrumb-7f2fb518.js";import{S as st,F as Qt,A as Wr}from"./ArrowBack-0391fed5.js";var Vr=class extends Dn{constructor(e,s){super(e,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,s){super.setOptions({...e,behavior:qt()},s)}getOptimisticResult(e){return e.behavior=qt(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,s){var c,u,h,m;const{state:n}=e,r=super.createResult(e,s),{isFetching:a,isRefetching:i}=r,o=a&&((u=(c=n.fetchMeta)==null?void 0:c.fetchMore)==null?void 0:u.direction)==="forward",l=a&&((m=(h=n.fetchMeta)==null?void 0:h.fetchMore)==null?void 0:m.direction)==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Nn(s,n.data),hasPreviousPage:Fn(s,n.data),isFetchingNextPage:o,isFetchingPreviousPage:l,isRefetching:i&&!o&&!l}}};function It(e,s){return Mn(e,Vr,s)}const T={fetchEntries:e=>{const s=["drive-entries"];return e&&s.push(e),s},fetchUserFolders(e){const s=["user-folders"];return e&&s.push(e),s},fetchShareableLink:e=>{const s=["shareable-link"];return e&&s.push(e),s},fetchFolderPath(e,s){const n=["folder-path"];return e&&n.push(e),s&&n.push(s),n},fetchEntryShareableLink:e=>["file-entries",e,"shareable-link"],fetchFileEntry:e=>{const s=["drive/file-entries/model"];return e&&s.push(e),s},fetchStorageSummary:["storage-summary"]};function W(){return Promise.all([A.invalidateQueries({queryKey:T.fetchEntries()}),A.invalidateQueries({queryKey:T.fetchFolderPath()}),A.invalidateQueries({queryKey:T.fetchUserFolders()}),A.invalidateQueries({queryKey:T.fetchFileEntry()})])}function Cs(){return se({queryKey:T.fetchStorageSummary,queryFn:Qr,select:Hr})}function Qr(){return I.get("user/space-usage").then(e=>e.data)}function Hr(e){const s=e.available===null?0:e.used*100/e.available;return{usedFormatted:ve(e.used,2),availableFormatted:ve(e.available,0),percentage:s,used:e.used,available:e.available}}function Yr(e){return t.jsx(Cn,{...e,role:"meter progressbar"})}function Gr(){const{isLoading:e,data:s}=Cs(),n=t.jsx("span",{className:P("whitespace-nowrap",e&&"invisible"),children:t.jsx(d,{message:":used of :available used",values:{used:s==null?void 0:s.usedFormatted,available:s==null?void 0:s.availableFormatted}})});return t.jsxs("div",{className:"mt-24 flex items-start gap-16 border-t pl-24 pt-24",children:[t.jsx(cr,{className:"-mt-4 icon-md"}),t.jsx(Yr,{className:"max-w-144 flex-auto",size:"xs",value:s==null?void 0:s.percentage,label:n,showValueLabel:!1,labelPosition:"bottom"})]})}function Zr(e){return M({mutationFn:s=>Xr(s),onSuccess:()=>{N(x("Created workspace")),A.invalidateQueries({queryKey:G.fetchUserWorkspaces})},onError:s=>Pe(s,e)})}function Xr(e){return I.post("workspace",e).then(s=>s.data)}function Jr(){const e=Ee(),{formId:s,close:n}=U(),r=Zr(e);return t.jsxs(ne,{children:[t.jsx(ie,{children:t.jsx(d,{message:"Create workspace"})}),t.jsx(Z,{children:t.jsx(De,{form:e,id:s,onSubmit:()=>{r.mutate(e.getValues(),{onSuccess:a=>{n(a.workspace.id)}})},children:t.jsx(Ne,{name:"name",autoFocus:!0,label:t.jsx(d,{message:"Workspace name"}),minLength:3,required:!0})})}),t.jsxs(ye,{children:[t.jsx(E,{variant:"text",onClick:n,children:t.jsx(d,{message:"Cancel"})}),t.jsx(E,{variant:"flat",color:"primary",type:"submit",form:s,disabled:r.isPending,children:t.jsx(d,{message:"Create"})})]})]})}function ea(e){return I.get(`workspace/${e}`).then(s=>s.data)}function ta(e){return se({queryKey:G.workspaceWithMembers(e),queryFn:()=>ea(e)})}function sa({workspaceId:e,...s}){return I.post(`workspace/${e}/invite`,s).then(n=>n.data)}function na(){return M({mutationFn:e=>sa(e),onSuccess:(e,s)=>{A.invalidateQueries({queryKey:G.workspaceWithMembers(s.workspaceId)})},onError:e=>z(e)})}function ra({workspaceId:e,inviteId:s,...n}){return I.post(`workspace/${e}/${s}/resend`,n).then(r=>r.data)}function aa(){return M({mutationFn:e=>ra(e),onSuccess:()=>{N("Invite sent")},onError:e=>z(e)})}function ia({workspaceId:e,member:s,...n}){const r=s.model_type,a=s.model_type==="invite"?s.id:s.member_id;return I.post(`workspace/${e}/${r}/${a}/change-role`,n).then(i=>i.data)}function oa(){return M({mutationFn:e=>ia(e),onSuccess:(e,s)=>{N(x("Role changed")),A.invalidateQueries({queryKey:G.workspaceWithMembers(s.workspaceId)})},onError:e=>z(e)})}function la({workspaceId:e,memberId:s,memberType:n}){const r=n==="invite"?`workspace/invite/${s}`:`workspace/${e}/member/${s}`;return I.delete(r).then(a=>a.data)}function As(){const{workspaceId:e,setWorkspaceId:s}=X(),{user:n}=O();return M({mutationFn:r=>la(r),onSuccess:(r,a)=>{A.invalidateQueries({queryKey:G.fetchUserWorkspaces}),A.invalidateQueries({queryKey:G.workspaceWithMembers(a.workspaceId)}),a.memberId===(n==null?void 0:n.id)&&e===a.workspaceId&&s(Fe.id)},onError:r=>z(r)})}function Ts({onConfirm:e,isLoading:s}){return t.jsx(be,{isDanger:!0,title:t.jsx(d,{message:"Leave workspace"}),isLoading:s,onConfirm:e,body:t.jsxs("div",{children:[t.jsx(d,{message:"Are you sure you want to leave this workspace?"}),t.jsx("div",{className:"mt-8 font-semibold",children:t.jsx(d,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:t.jsx(d,{message:"Leave"})})}const ca=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function Ls(e){return!e||e.length>320?!1:ca.test(e)}function da({workspace:e}){const{data:s,isLoading:n}=ta(e.id);return t.jsxs(ne,{size:"lg",children:[t.jsx(ie,{children:t.jsx(d,{message:"Manage workspace members"})}),t.jsx(Z,{children:n?t.jsx("div",{className:"flex min-h-[238px] items-center justify-center",children:t.jsx(te,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):t.jsx(ua,{workspace:s.workspace})})]})}function ua({workspace:e}){const{user:s}=O(),n=Pt(e),r=[...e.members||[],...e.invites||[]],a=!n.update&&!n.delete;return t.jsxs("div",{children:[n.invite&&t.jsx(ha,{workspace:e}),t.jsxs("div",{className:"mb-14 flex items-center gap-10 text-base",children:[t.jsx(dr,{className:"icon-sm"}),t.jsx(d,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),t.jsxs(J,{initial:!1,children:[r.map(i=>a&&i.id!==(s==null?void 0:s.id)?null:t.jsx(ma,{workspace:e,member:i},`${i.model_type}.${i.id}`)),a&&t.jsx("div",{className:"text-muted",children:t.jsx(d,{message:"And [one one other member|:count other members]",values:{count:r.length}})})]})]})}function ma({workspace:e,member:s}){return t.jsxs(K.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-start gap-14 text-sm",children:[t.jsx(dt,{className:"flex-shrink-0",size:"lg",circle:!0,label:s.name,src:s.image,fallback:"initials"}),t.jsxs("div",{className:"min-w-0 flex-auto items-center justify-between gap-14 md:flex",children:[t.jsxs("div",{className:"mb-10 overflow-hidden md:mb-0 md:mr-10",children:[t.jsxs("div",{className:"flex items-center justify-start gap-6",children:[t.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:s.name}),t.jsx(ga,{workspace:e,member:s})]}),t.jsx("div",{className:"text-muted",children:s.email})]}),t.jsx(fa,{workspace:e,member:s})]})]},`${s.model_type}.${s.id}`)}function Pt(e){var i;const{user:s}=O(),n={update:!1,invite:!1,delete:!1},r=["update","invite","delete"],a=(i=e.members)==null?void 0:i.find(o=>o.id===(s==null?void 0:s.id));return a&&r.forEach(o=>{var l;n[o]=a.is_owner||!!((l=a.permissions)!=null&&l.find(c=>c.name===`workspace_members.${o}`))}),n}function fa({workspace:e,member:s}){const[n,r]=f.useState(s.role_id),a=oa(),{user:i}=O(),o=Pt(e),l=s.model_type==="member"&&s.is_owner,c=s.model_type==="member"&&(i==null?void 0:i.id)===s.id,u=!o.update||l||c?t.jsx("div",{className:"ml-auto text-muted first:capitalize",children:t.jsx(d,{message:s.role_name})}):t.jsx(Rs,{className:"ml-auto flex-shrink-0",size:"xs",value:n,isDisabled:a.isPending,onChange:h=>{r(h),a.mutate({roleId:h,workspaceId:e.id,member:s})}});return t.jsxs(t.Fragment,{children:[u,!l&&(c||o.delete)&&t.jsx(xa,{type:c?"leave":"remove",member:s,workspace:e})]})}function ha({workspace:e}){const{trans:s}=B(),[n,r]=f.useState([]),a=n.every(h=>!h.invalid),i=h=>h.description||h.name,[o,l]=f.useState(),c=na(),{data:u}=ns(["workspaceRoles"]);return f.useEffect(()=>{var h;!o&&((h=u==null?void 0:u.workspaceRoles)!=null&&h.length)&&l(u.workspaceRoles[0].id)},[u,o]),t.jsxs("div",{className:"mb-30",children:[t.jsx(js,{value:n,onChange:r,displayWith:i,validateWith:h=>{const m=!Ls(h.description);return{...h,invalid:m,errorMessage:m?s({message:"Not a valid email"}):void 0}},placeholder:s({message:"Enter email addresses"}),label:t.jsx(d,{message:"Invite people"})}),t.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[t.jsx(Rs,{onChange:l,value:o}),n.length&&o?t.jsx(E,{variant:"flat",color:"primary",size:"sm",disabled:c.isPending||!a,onClick:()=>{c.mutate({emails:n.map(h=>i(h)),roleId:o,workspaceId:e.id},{onSuccess:()=>{r([])}})},children:t.jsx(d,{message:"Invite"})}):null]})]})}function xa({member:e,workspace:s,type:n}){const r=As(),{close:a}=U();return t.jsxs(ue,{type:"modal",onClose:i=>{i&&(r.mutate({workspaceId:s.id,memberId:e.id,memberType:e.model_type}),n==="leave"&&(a(),N(x("Left workspace"))))},children:[t.jsx(L,{size:"md",className:"flex-shrink-0 text-muted",disabled:r.isPending,children:n==="leave"?t.jsx(rs,{}):t.jsx(we,{})}),n==="leave"?t.jsx(Ts,{}):t.jsx(pa,{member:e})]})}function pa({member:e}){return t.jsx(be,{isDanger:!0,title:t.jsx(d,{message:"Remove member"}),body:t.jsxs("div",{children:[t.jsx(d,{message:"Are you sure you want to remove `:name`?",values:{name:e.name}}),t.jsx("div",{className:"mt-8 font-semibold",children:t.jsx(d,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.name}})})]}),confirm:t.jsx(d,{message:"Remove"})})}function Rs({value:e,onChange:s,size:n="xs",className:r,isDisabled:a}){var l;const{data:i}=ns(["workspaceRoles"]),o=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(c=>c.id===e);return!e||!o||!(i!=null&&i.workspaceRoles)?null:t.jsxs(me,{selectionMode:"single",selectedValue:e,onSelectionChange:c=>{s(c)},children:[t.jsx(E,{className:r,size:n,variant:"flat",color:"chip",disabled:a,endIcon:t.jsx(ut,{}),children:t.jsx(d,{message:o.name})}),t.jsx(fe,{children:i.workspaceRoles.map(c=>t.jsx(_,{value:c.id,description:c.description,children:t.jsx(d,{message:c.name})},c.id))})]})}function ga({member:e,workspace:s}){const{user:n}=O(),r=Pt(s);return(n==null?void 0:n.id)===e.id?t.jsxs("div",{className:"font-medium",children:["(",t.jsx(d,{message:"You"}),")"]}):e.model_type==="invite"?t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{children:"·"}),t.jsx("div",{className:"font-medium",children:t.jsx(d,{message:"Invited"})}),r.invite?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"·"}),t.jsx(va,{member:e,workspace:s})]}):null]}):null}function va({member:e,workspace:s}){const n=aa();return t.jsxs(ue,{type:"modal",onClose:r=>{r&&n.mutate({workspaceId:s.id,inviteId:e.id})},children:[t.jsx(E,{variant:"link",size:"sm",color:"primary",disabled:n.isPending,children:t.jsx(d,{message:"Resend invite"})}),t.jsx(be,{title:t.jsx(d,{message:"Resend invite"}),body:t.jsx(d,{message:"Are you sure you want to send this invite again?"}),confirm:t.jsx(d,{message:"Send"})})]})}function ja({id:e,...s}){return I.put(`workspace/${e}`,s).then(n=>n.data)}function ya(e){const{close:s}=U();return M({mutationFn:n=>ja(n),onSuccess:n=>{s(),N(x("Updated workspace")),A.invalidateQueries({queryKey:G.fetchUserWorkspaces}),A.invalidateQueries({queryKey:G.workspaceWithMembers(n.workspace.id)})},onError:n=>Pe(n,e)})}function ba({workspace:e}){const s=Ee({defaultValues:{id:e.id,name:e.name}}),{formId:n,close:r}=U(),a=ya(s);return t.jsxs(ne,{children:[t.jsx(ie,{children:t.jsx(d,{message:"Rename workspace"})}),t.jsx(Z,{children:t.jsx(De,{form:s,id:n,onSubmit:()=>{a.mutate(s.getValues())},children:t.jsx(Ne,{name:"name",autoFocus:!0,label:t.jsx(d,{message:"Name"}),minLength:3,required:!0})})}),t.jsxs(ye,{children:[t.jsx(E,{variant:"text",onClick:r,children:t.jsx(d,{message:"Cancel"})}),t.jsx(E,{variant:"flat",color:"primary",type:"submit",form:n,disabled:a.isPending,children:t.jsx(d,{message:"Rename"})})]})]})}function wa({id:e}){return I.delete(`workspace/${e}`).then(s=>s.data)}function Sa(){const{workspaceId:e,setWorkspaceId:s}=X();return M({mutationFn:n=>wa(n),onSuccess:(n,r)=>{N(x("Deleted workspace")),A.invalidateQueries({queryKey:G.fetchUserWorkspaces}),A.invalidateQueries({queryKey:G.workspaceWithMembers(r.id)}),e===r.id&&s(Fe.id)},onError:n=>z(n)})}function ka({resourceName:e,className:s,size:n="md",color:r="bgAlt",reason:a="overQuota",...i}){const o=i.message??t.jsx(Ia,{resourceName:e,reason:a});return t.jsx(Kr,{color:r,size:n,className:s,description:o})}function Ia({resourceName:e,reason:s}){const{billing:n}=Me();if(s==="noWorkspacePermission")return t.jsx(d,{message:"You can't create new :name in this workspace.",values:{name:e}});const r={name:e,a:a=>t.jsx(Ze,{className:An,to:"/pricing",children:a})};return s==="overQuota"&&n.enable?t.jsx(d,{message:"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>",values:r}):s==="noPermission"&&n.enable?t.jsx(d,{message:"To unlock ability to create :name. <a>Upgrade your plan.</a>",values:r}):t.jsx(d,{message:"You don't have permissions to create :name."})}function Pa({onChange:e,className:s,trigger:n,placement:r="top"}){const{data:a,isFetched:i,isFetching:o}=Ln(),{setWorkspaceId:l}=X(),c=mt(),[u,h]=f.useState(!1),{hasPermission:m}=O();return f.useEffect(()=>{i&&!o&&!c&&l(Fe.id)},[c,a,l,i,o]),!n&&(!c||!m("workspaces.create")&&(a==null?void 0:a.length)===1)?null:t.jsx(f.Fragment,{children:t.jsxs(ue,{type:"popover",placement:r,isOpen:u,onClose:()=>{h(!1)},children:[n?f.cloneElement(n,{onClick:()=>h(!u)}):t.jsx(Da,{onClick:()=>h(!u),workspace:c,className:s}),t.jsx(ne,{size:"min-w-320",children:t.jsxs(Z,{padding:"p-10",children:[t.jsx("div",{className:"mb-16 border-b pb-10",children:a==null?void 0:a.map(g=>t.jsx(Na,{workspace:g,setSelectorIsOpen:h,onChange:e},g.id))}),t.jsx("div",{className:"mb-4 px-4 text-center",children:t.jsx(Ea,{onClick:()=>h(!1),onCreated:g=>e==null?void 0:e(g),workspaceCount:a?a.length-1:0})})]})})]})})}function Ea({onClick:e,onCreated:s,workspaceCount:n}){const{setWorkspaceId:r}=X(),{checkOverQuotaOrNoPermission:a}=O(),{overQuotaOrNoPermission:i}=a("workspaces.create","count",n);return t.jsxs(f.Fragment,{children:[t.jsx(E,{disabled:i,onClick:async o=>{o.preventDefault(),o.stopPropagation(),e();const l=await Se(Jr);l&&(r(l),s==null||s(l))},variant:"outline",startIcon:t.jsx(jt,{}),color:"primary",className:"h-40 w-full",children:t.jsx(d,{message:"Create new workspace"})}),i&&t.jsx(ka,{size:"sm",className:"mt-12 max-w-288",resourceName:t.jsx(d,{message:"worksapces"})})]})}const Da=f.forwardRef(({workspace:e,className:s,onClick:n,...r},a)=>t.jsxs(as,{ref:a,onClick:n,className:P("flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2",s),...r,children:[t.jsxs("span",{className:"mr-auto block flex-auto overflow-hidden text-left",children:[t.jsx("span",{className:"block overflow-hidden overflow-ellipsis text-sm font-medium text-main",children:e.default?t.jsx(d,{message:e.name}):e.name}),t.jsx("span",{className:"block text-xs text-muted",children:e.default?t.jsx(d,{message:"Personal workspace"}):t.jsx(d,{message:":count members",values:{count:e.members_count}})})]}),t.jsx(Tn,{className:"shrink-0 icon-md"})]}));function Na({workspace:e,onChange:s,setSelectorIsOpen:n}){const{workspaceId:r,setWorkspaceId:a}=X(),i=r===e.id;return t.jsxs("div",{onClick:()=>{a(e.id),s==null||s(e.id),n(!1)},className:P("mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left",i&&"bg-primary/5",!i&&"hover:bg-hover"),children:[t.jsx(is,{size:"sm",className:P("flex-shrink-0 text-primary",!i&&"invisible")}),t.jsxs("div",{className:"flex-auto",children:[t.jsx("div",{className:P("text-sm",i&&"font-semibold"),children:e.name}),t.jsx("div",{className:"text-sm text-muted",children:e.default?t.jsx(d,{message:"Personal workspace"}):t.jsx(d,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&t.jsx(Ca,{setSelectorIsOpen:n,workspace:e,onChange:s})]})}function Fa({workspace:e,onChange:s}){const n=As(),{user:r}=O(),{close:a}=U();return t.jsx(Ts,{isLoading:n.isPending,onConfirm:()=>{n.mutate({workspaceId:e.id,memberId:r.id,memberType:"member"},{onSuccess:()=>{a(),s==null||s(Fe.id)}})}})}function Ma({workspace:e,onChange:s}){const n=Sa(),{close:r}=U();return t.jsx(be,{isDanger:!0,title:t.jsx(d,{message:"Delete workspace"}),body:t.jsx(d,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:t.jsx(d,{message:"Delete"}),isLoading:n.isPending,onConfirm:()=>{n.mutate({id:e.id},{onSuccess:()=>{r(),s==null||s(Fe.id)}})}})}function Ca({setSelectorIsOpen:e,workspace:s,onChange:n}){const{user:r}=O();return t.jsxs(me,{onItemSelected:()=>e(!1),children:[t.jsx(E,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:t.jsx(os,{}),children:t.jsx(d,{message:"Manage"})}),t.jsxs(fe,{children:[t.jsx(_,{onClick:a=>{a.stopPropagation(),Se(da,{workspace:s})},value:"workspaceMembers",startIcon:t.jsx(ps,{}),children:t.jsx(d,{message:"Members"})}),s.owner_id===(r==null?void 0:r.id)&&t.jsx(_,{onClick:a=>{a.stopPropagation(),Se(ba,{workspace:s})},value:"updateWorkspace",startIcon:t.jsx(Br,{}),children:t.jsx(d,{message:"Rename"})}),s.owner_id!==(r==null?void 0:r.id)&&t.jsx(_,{onClick:a=>{a.stopPropagation(),Se(Fa,{workspace:s,onChange:n})},value:"leaveWorkspace",startIcon:t.jsx(rs,{}),children:t.jsx(d,{message:"Leave"})}),s.owner_id===(r==null?void 0:r.id)&&t.jsx(_,{onClick:a=>{a.stopPropagation(),Se(Ma,{workspace:s,onChange:n})},value:"deleteWorkspace",startIcon:t.jsx(yt,{}),children:t.jsx(d,{message:"Delete"})})]})]})}const Aa=""+new URL("add-files-477f2f7e.svg",import.meta.url).href,Ta=""+new URL("time-management-468b570b.svg",import.meta.url).href,Ht=""+new URL("file-searching-9e047848.svg",import.meta.url).href,La=""+new URL("throw-away-18cdb22c.svg",import.meta.url).href,Ra=""+new URL("loving-it-55a9e8bc.svg",import.meta.url).href,zs=""+new URL("share-9fa4dd2e.svg",import.meta.url).href,Re={orderBy:"updated_at",orderDir:"desc"};function Et(e){return{...qs(e.hash),canUpload:e.permissions["files.create"]||e.permissions["files.update"],label:e.name,folder:e}}function qs(e){return{name:"folder",uniqueId:e,label:"",path:nt(e),hasActions:!0,canUpload:!1,sortDescriptor:Re,isFolderPage:!0,noContentMessage:()=>({title:x("Drop files or folders here"),description:x('Or use the "Upload" button'),image:Aa})}}function nt(e){return e==="0"?"/drive":`/drive/folders/${e}`}const za=ft().rootFolder,q={...Et(za),name:"home"},qa={name:"recent",uniqueId:"recent",label:x("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:x("No recent entries"),description:x("You have not uploaded any files or folders yet"),image:Ta})},ee={name:"search",uniqueId:"search",label:x("Search results"),path:"/drive/search",sortDescriptor:Re,noContentMessage:e=>e?{title:x("No matching results"),description:x("Try changing your search query or filters"),image:Ht}:{title:x("Begin typing or select a filter to search"),description:x("Search for files, folders and other content"),image:Ht}},je={name:"sharedWithMe",uniqueId:"sharedWithMe",label:x("Shared"),path:"/drive/shares",sortDescriptor:Re,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:x("Shared with me"),description:x("Files and folders other people have shared with you"),image:zs})},R={name:"trash",uniqueId:"trash",label:x("Trash"),path:"/drive/trash",sortDescriptor:Re,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:x("Trash is empty"),description:x("There are no files or folders in your trash currently"),image:La})},_a={name:"starred",uniqueId:"starred",label:x("Starred"),path:"/drive/starred",sortDescriptor:Re,queryParams:{starredOnly:!0},noContentMessage:()=>({title:x("Nothing is starred"),description:x("Add stars to files and folders that you want to easily find later"),image:Ra})},$a=[q,qa,ee,je,R,_a];var _s=(e=>(e.DriveSidebar="drive-sidebar",e))(_s||{}),$s={};(function(e){var s=_t&&_t.__assign||function(){return(s=Object.assign||function(o){for(var l,c=1,u=arguments.length;c<u;c++)for(var h in l=arguments[c])Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h]);return o}).apply(this,arguments)},n=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function r(o,l){l===void 0&&(l={});for(var c,u=s(s({},n),l),h=[],m={},g=u.throwIfOrphans?new Set:null,j=0,S=o;j<S.length;j++){var v=S[j],w=u.nestedIds?i(v,u.id):v[u.id],F=u.nestedIds?i(v,u.parentId):v[u.parentId];if(u.rootParentIds[w])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(w,'", `rootParentIds`: ').concat(Object.keys(u.rootParentIds).map(function(D){return'"'.concat(D,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(m,w)||(m[w]=((c={})[u.childrenField]=[],c)),g&&g.delete(w),u.dataField?m[w][u.dataField]=v:u.assign?m[w]=Object.assign(v,((c={})[u.childrenField]=m[w][u.childrenField],c)):m[w]=s(s({},v),((v={})[u.childrenField]=m[w][u.childrenField],v)),v=m[w],F==null||u.rootParentIds[F]?h.push(v):(Object.prototype.hasOwnProperty.call(m,F)||(m[F]=((w={})[u.childrenField]=[],w),g&&g.add(F)),m[F][u.childrenField].push(v))}if(g!=null&&g.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(g),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(u.throwIfOrphans&&a(h,u.childrenField)<Object.keys(m).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return h}function a(o,l){return o.reduce(function(c,u){return c+1+(u[l]&&a(u[l],l))},0)}function i(o,l){return l.split(".").reduce(function(c,u){return c&&c[u]},o)}e.arrayToTree=r,e.countNodes=a})($s);function Oa(e){return I.get(`users/${e.userId}/folders`,{params:e}).then(s=>s.data)}function Os(){const{user:e}=O(),{workspaceId:s}=X(),n={userId:e.id,workspaceId:s};return se({queryKey:T.fetchUserFolders(n),queryFn:()=>Oa(n),enabled:!!e})}const Ka=[];Rn();var ts,ss;const Yt={uploadQueueIsOpen:!1,contextMenuData:null,selectedEntries:new Set,entriesBeingDragged:[],activeActionDialog:null,sidebarExpandedKeys:[],viewMode:Be("drive.viewMode",((ss=(ts=ft().settings)==null?void 0:ts.drive)==null?void 0:ss.default_view)||"grid"),sortDescriptor:{orderBy:"updated_at",orderDir:"desc"}},b=ls()(cs((e,s)=>({...Yt,setUploadQueueIsOpen:n=>{e(r=>{r.uploadQueueIsOpen=n})},setContextMenuData:n=>{e(r=>{r.contextMenuData=n})},setSortDescriptor:n=>{e(r=>{var i;const a=(i=s().activePage)==null?void 0:i.uniqueId;a&&it("selectedSorting",{...Be("selectedSorting"),[a]:n}),r.sortDescriptor=n})},setActivePage:n=>{e(r=>{var i,o;r.activePage=n;const a=(i=Be("selectedSorting"))==null?void 0:i[n.uniqueId];r.sortDescriptor=a||n.sortDescriptor,n.uniqueId!==((o=s().activePage)==null?void 0:o.uniqueId)&&r.selectedEntries.size&&r.selectedEntries.clear()})},setEntriesBeingDragged:n=>{e(r=>{r.entriesBeingDragged=n})},setActiveActionDialog:(n,r=Ka)=>{e(a=>{const i=s().activeActionDialog;((i==null?void 0:i.name)!==n||i.entries!==r)&&(a.activeActionDialog=n?{name:n,entries:r}:null)})},setViewMode:n=>{e(r=>{r.viewMode=n,it("drive.viewMode",n)})},setSidebarExpandedKeys:n=>e(r=>{r.sidebarExpandedKeys=n}),expandSidebarItem:n=>e(r=>{r.sidebarExpandedKeys.includes(n)||r.sidebarExpandedKeys.push(n)}),collapseSidebarItem:n=>e(r=>{const a=r.sidebarExpandedKeys.indexOf(n);a>-1&&r.sidebarExpandedKeys.splice(a,1)}),toggleSidebarItem:n=>e(r=>{r.sidebarExpandedKeys.includes(n)?r.expandSidebarItem(n):r.collapseSidebarItem(n)}),selectEntries:(n,r)=>{e(a=>{r||a.selectedEntries.clear(),n.forEach(i=>i&&a.selectedEntries.add(i))})},deselectEntries:n=>{e(r=>{r.selectedEntries.size&&(n==="all"?r.selectedEntries=new Set:n.forEach(a=>r.selectedEntries.delete(a)))})},reset:()=>{e(Yt)}})));function p(){return b.getState()}function Ba(){const e=b(s=>s.activeActionDialog);return e==null?void 0:e.entries[0]}function Ks(){return M({mutationFn:e=>(N.loading(x("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),Ua(e)),onSuccess:(e,s)=>{W(),N(x('Moved [one 1 item|other :count items] to ":destination"',{values:{count:s.entryIds.length,destination:(e.destination||q.folder).name}}),{disableEnterAnimation:!0})},onError:e=>z(e,x("Could not move items"),null,{disableEnterAnimation:!0})})}function Ua(e){return e.destinationId=e.destinationId?e.destinationId:null,I.post("file-entries/move",e).then(s=>s.data)}const Wa=8388608;function ze(){const e=ae(l=>l.uploadMultiple),{data:s}=Cs(),{uploads:n}=Me(),r=n.max_size||Wa,a=n.allowed_extensions,i=n.blocked_extensions;return{uploadFiles:f.useCallback((l,c={})=>{var u,h;if(c.metadata||(c.metadata={}),c.metadata.workspaceId=ds(),c.metadata.parentId||(c.metadata.parentId=((h=(u=p().activePage)==null?void 0:u.folder)==null?void 0:h.id)??null),l=[...l].map(m=>m instanceof $t?m:new $t(m)),s){const m=l.reduce((S,v)=>S+v.size,0),g=s.used,j=s.available;if(m+g>j){N.danger(x("You have exhausted your allowed space of :space. Delete some files or upgrade your plan.",{values:{space:s.availableFormatted}}),{action:{action:"/pricing",label:x("Upgrade")}});return}}e(l,{...c,restrictions:{maxFileSize:r,allowedFileTypes:a,blockedFileTypes:i},onSuccess:(m,g)=>{var j;(j=c==null?void 0:c.onSuccess)==null||j.call(c,m,g),W(),A.invalidateQueries({queryKey:T.fetchStorageSummary})}}),p().setUploadQueueIsOpen(!0)},[e,a,i,r,s])}}function Dt(e,s){return s.type!=="folder"||!s.permissions["files.update"]&&!e.every(n=>n.permissions["files.update"])?!1:e.every(n=>!n||s.id===n.parent_id||!n.parent_id&&s.id===0?!1:!Va(s,n))}function Va(e,s){const n=(e.path||"").split("/");return(s.path||"").split("/").every((a,i)=>n[i]===a)}function Bs(e){const s=Ks(),{uploadFiles:n}=ze();return{onDrop:async a=>{if(e.type==="folder"){if(a.type==="nativeFile")n(await a.getData(),{metadata:{parentId:e.id}});else if(a.type==="fileEntry"){const i=a.getData();i!=null&&i.length&&Dt(i,e)&&(s.mutate({destinationId:e.id,entryIds:i.map(o=>o.id)}),p().deselectEntries("all"))}}}}}function lt(e,s){if(e.type==="fileEntry"){const n=e.getData();return Dt(n,s)}return!0}function Nt(e){return`${e.id}-tree`}function Qa(e){return`${e}`.endsWith("-tree")}function Ha({folder:e,ref:s}){const[n,r]=f.useState(!1),{onDrop:a}=Bs(e);return{...tt({id:Nt(e),ref:s,types:["fileEntry","nativeFile"],acceptsDrop:o=>lt(o,e),onDragEnter:o=>{lt(o,e)&&r(!0)},onDragLeave:()=>{r(!1)},onDropActivate:()=>{p().sidebarExpandedKeys.includes(e.id)||p().setSidebarExpandedKeys([...p().sidebarExpandedKeys,e.id])},onDrop:a}),isDragOver:n}}const Ft=f.createContext(null);function Us({nodes:e,itemRenderer:s,parentNode:n,level:r}){return e.map((a,i)=>f.cloneElement(s(a),{level:r==null?0:r+1,index:i,node:a,parentNode:n,key:a.id,itemRenderer:s}))}function Ya({children:e,nodes:s,...n}){const[r,a]=Ot(n.expandedKeys,n.defaultSelectedKeys,n.onExpandedKeysChange),[i,o]=Ot(n.selectedKeys,n.defaultSelectedKeys,n.onSelectedKeysChange),[l,c]=f.useState(),u={expandedKeys:r,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:l,setFocusedNode:c};return t.jsx(Ft.Provider,{value:u,children:t.jsx(zn,{children:t.jsx(Ga,{nodes:s,itemRenderer:e})})})}function Ga(e){return t.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:Us(e)})}const Ws=f.forwardRef(({icon:e,label:s,level:n=0,node:r,className:a,...i},o)=>{const{expandedKeys:l,setExpandedKeys:c,selectedKeys:u,setSelectedKeys:h}=f.useContext(Ft),m=l.includes(r.id),g=u.includes(r.id),j=S=>{S.stopPropagation();const v=l.indexOf(r.id),w=[...l];v>-1?w.splice(v,1):w.push(r.id),c(w)};return t.jsxs("div",{...i,ref:o,onClick:S=>{S.stopPropagation(),h([r.id])},className:P("header tree-label flex cursor-pointer flex-nowrap items-center gap-4 overflow-hidden text-ellipsis whitespace-nowrap rounded py-6",a,g&&"bg-primary/selected font-bold text-primary",!g&&"hover:bg-hover"),children:[n>0&&t.jsx("div",{className:"flex",children:Array.from({length:n}).map((S,v)=>t.jsx("div",{className:"h-24 w-24"},v))}),t.jsx("div",{onClick:j,children:t.jsx(ur,{className:P("cursor-default transition-transform icon-sm",m&&"rotate-90")})}),e,t.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:s})]})});Ws.displayName="TreeLabel";function Za({label:e,icon:s,node:n,level:r,index:a,itemRenderer:i,labelRef:o,labelClassName:l,className:c,parentNode:u,...h}){const m=qn(),{expandedKeys:g,selectedKeys:j,focusedNode:S,setFocusedNode:v,setExpandedKeys:w,setSelectedKeys:F}=f.useContext(Ft);if(f.useEffect(()=>()=>{S===(n==null?void 0:n.id)&&v(void 0)},[S,n==null?void 0:n.id,v]),!n||!i)return null;const D=n.children.length,y=D&&g.includes(n.id),$=j.includes(n.id),H=r===0&&a===0,V=S==null?H:S===n.id,C=k=>{var re,at;if(S!=null)switch(k.key){case"Enter":case" ":k.stopPropagation(),k.preventDefault(),F([S]);break;case"ArrowRight":if(k.stopPropagation(),k.preventDefault(),!D)return;y?m==null||m.focusNext():w([...g,S]);break;case"ArrowLeft":if(k.stopPropagation(),k.preventDefault(),y){const Y=g.indexOf(S),xe=[...g];xe.splice(Y,1),w(xe)}else if(u){const Y=(at=(re=document.activeElement)==null?void 0:re.parentElement)==null?void 0:at.closest("[tabindex]");Y&&Y.focus()}break;case"ArrowDown":k.stopPropagation(),k.preventDefault(),m==null||m.focusNext();break;case"ArrowUp":k.stopPropagation(),k.preventDefault(),m==null||m.focusPrevious();break;case"Home":k.stopPropagation(),k.preventDefault(),m==null||m.focusFirst();break;case"End":k.stopPropagation(),k.preventDefault(),m==null||m.focusLast();break;case"*":if(k.stopPropagation(),k.preventDefault(),u!=null&&u.children){const Y=[...g];u.children.forEach(xe=>{xe.children.length&&!g.includes(xe.id)&&Y.push(xe.id)}),Y.length!==g.length&&w(Y)}break}};return t.jsxs("li",{role:"treeitem","aria-expanded":y?"true":"false","aria-selected":$,tabIndex:V?0:-1,onKeyDown:Ue(C),onFocus:k=>{k.stopPropagation(),v(n.id)},onBlur:k=>{k.stopPropagation(),k.currentTarget.contains(k.relatedTarget)||v(void 0)},className:P("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",c),children:[t.jsx(Ws,{ref:o,className:l,node:n,level:r,label:e,icon:s,...h}),t.jsx(J,{initial:!1,children:y?t.jsx(K.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:Us({nodes:n.children,parentNode:n,itemRenderer:i,level:r})},`${n.id}-group`):null})]})}function Xa(){const e=he(),{data:s}=Os(),n=b(o=>o.sidebarExpandedKeys),r=b(o=>o.activePage);let a=[];r!=null&&r.isFolderPage&&(a=r.folder?[r.folder.id]:[]);const i=f.useMemo(()=>{const o=$s.arrayToTree((s==null?void 0:s.folders)||[],{parentId:"parent_id",dataField:null});return[{...q.folder,children:o}]},[s==null?void 0:s.folders]);return t.jsx(Ya,{nodes:i,expandedKeys:n,onExpandedKeysChange:o=>{p().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const l=Vs(o,i);e(l?nt(l):q.path)},children:()=>t.jsx(Ja,{})})}function Ja(e){const{node:s}=e,n=f.useRef(null),r=s.id===0,a=b(c=>c.entriesBeingDragged.includes(s.id)),{draggableProps:i}=ys({type:"fileEntry",id:Nt(s),ref:n,disabled:r,hidePreview:!0,onDragStart:(c,u)=>{const h=u;p().setEntriesBeingDragged(h.getData().map(m=>m.id)),p().selectEntries([])},onDragEnd:()=>{p().setEntriesBeingDragged([])},getData:()=>[s]}),{droppableProps:o,isDragOver:l}=Ha({folder:s,ref:n});return t.jsx(Za,{...Xe(i,o,e),onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),p().deselectEntries("all"),p().setContextMenuData({x:c.clientX,y:c.clientY,entry:s})},labelRef:n,className:r?"focus-visible:ring-2":void 0,labelClassName:P(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",r&&"h-40"),icon:r?t.jsx(mr,{size:"md",className:"mr-6"}):t.jsx(Qe,{size:"sm",className:"mr-4"}),label:s.name})}const Vs=(e,s)=>{for(const n of s){if(n.id===e)return n.hash;if(n.children){const r=Vs(e,n.children);if(r)return r}}};function ei(e){return I.post("file-entries/delete",e).then(s=>s.data)}function qe(){return M({mutationFn:e=>(N.loading(ti(e),{disableExitAnimation:!0}),ei(e)),onSuccess:(e,{entryIds:s,emptyTrash:n,deleteForever:r})=>{W(),A.invalidateQueries({queryKey:T.fetchStorageSummary}),n?N(x("Emptied trash"),{disableEnterAnimation:!0}):r?N(x("Permanently deleted [one 1 item|other :count items]",{values:{count:s.length}}),{disableEnterAnimation:!0}):N(x("Moved [one 1 item|other :count items] to trash",{values:{count:s.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:s})=>{const n=_n(e);n?N.danger(n,{disableEnterAnimation:!0}):s?N.danger("could not empty trash",{disableEnterAnimation:!0}):N.danger("Could not delete items",{disableEnterAnimation:!0})}})}function ti(e){return e.emptyTrash?x("Emptying trash..."):e.deleteForever?x("Deleting files..."):x("Moving to trash...")}function si(){return t.jsxs("div",{className:"mt-26 px-12 text-muted",children:[t.jsx(Xa,{}),t.jsx(On,{menu:_s.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?t.jsx(ni,{item:e},e.id):t.jsx(Qs,{item:e},e.id)})]})}const Qs=f.forwardRef(({item:e,className:s,...n},r)=>t.jsx($n,{className:({isActive:a})=>P(s,"my-4 h-40 w-full rounded px-24",a?"cursor-default bg-primary/selected font-bold text-primary":"hover:bg-hover"),item:e,ref:r,...n}));function ni({item:e}){const s=qe(),[n,r]=f.useState(!1),a=f.useRef(null),{droppableProps:i}=tt({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:o=>{const l=o.getData().map(c=>c.id);s.mutate({entryIds:l,deleteForever:!1})}});return t.jsx(Qs,{className:P(n&&"bg-primary/selected"),ref:a,...i,item:e})}function Hs({isCompact:e,className:s}){const n=b(i=>i.activePage),{uploadFiles:r}=ze(),a=e?t.jsx(L,{size:"md",disabled:!(n!=null&&n.canUpload),children:t.jsx(jt,{})}):t.jsx(E,{className:"min-w-160",color:"primary",variant:"flat",size:"sm",startIcon:t.jsx(gs,{}),disabled:!(n!=null&&n.canUpload),children:t.jsx(d,{message:"Upload"})});return t.jsx("div",{className:s,children:t.jsxs(me,{onItemSelected:async i=>{var o;if(i==="uploadFiles")r(await We({multiple:!0}));else if(i==="uploadFolder")r(await We({directory:!0}));else if(i==="newFolder"){const l=(o=p().activePage)==null?void 0:o.folder;p().setActiveActionDialog("newFolder",l?[l]:[])}},children:[a,t.jsxs(fe,{children:[t.jsx(_,{value:"uploadFiles",startIcon:t.jsx(fr,{}),children:t.jsx(d,{message:"Upload files"})}),t.jsx(_,{value:"uploadFolder",startIcon:t.jsx(vs,{}),children:t.jsx(d,{message:"Upload folder"})}),t.jsx(_,{value:"newFolder",startIcon:t.jsx(vt,{}),children:t.jsx(d,{message:"Create folder"})})]})]})})}function ri({className:e}){const{isSubscribed:s}=O(),{billing:n}=Me();return t.jsxs("div",{className:P(e,"flex flex-col gap-20 border-r bg-alt text-sm font-medium text-muted"),children:[t.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:[t.jsx(Hs,{className:"px-12 pt-28 text-center"}),t.jsx(si,{}),t.jsx(Gr,{}),n.enable?t.jsx("div",{className:"mt-14 pl-60",children:t.jsx(E,{elementType:Ze,to:s?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:t.jsx(d,{message:"Upgrade"})})}):null]}),t.jsx(ai,{})]})}function ai(){const e=he();return t.jsx(Pa,{onChange:()=>{e(q.path)},className:"mt-auto w-full flex-shrink-0 border-t px-24 py-18"})}function ii(e){return I.get("drive/file-entries",{params:e}).then(s=>s.data)}const oi=e=>{var a;const n=e.pages[0].folder,r=p().activePage;return n&&r&&r.uniqueId===n.hash&&(!r.folder||!Kn(n.permissions,(a=r.folder)==null?void 0:a.permissions))&&p().setActivePage(Et(n)),e};function Ys(){const e=b(l=>l.activePage),s=b(l=>l.sortDescriptor),[n]=Je(),{workspaceId:r}=X(),a={section:e==null?void 0:e.name,...e==null?void 0:e.queryParams,...Object.fromEntries(n),folderId:e!=null&&e.isFolderPage?e.uniqueId:null,workspaceId:r,...s},i=e===ee&&!a.query&&!a.filters,o=It({queryKey:T.fetchEntries(a),queryFn:({pageParam:l=1})=>ii({...a,page:l}),initialPageParam:1,getNextPageParam:l=>{const c=l.current_page;if(bs(l))return c+1},enabled:e!=null&&!i});return f.useEffect(()=>{var l;(l=o.data)!=null&&l.pages[0].folder&&oi(o.data)},[o.data]),o}function li(){return A.getQueriesData({queryKey:T.fetchEntries()}).reduce((s,n)=>{const r=n[1]?n[1].pages.flatMap(a=>a.data):[];return[...s,...r]},[])}const Gs=[Dr,{key:"owner_id",label:x("Owner"),description:x("User file was uploaded by"),defaultOperator:_e.eq,control:{type:$e.Select,defaultValue:"02",options:[{key:"01",label:x("anyone"),value:{value:null,operator:"!="}},{key:"02",label:x("me"),value:"{authId}"},{key:"03",label:x("not me"),value:{value:"{authId}",operator:"!="}}]}},Nr({description:x("Date file was uploaded")}),Fr({description:x("Date file was last changed")}),{key:"deleted_at",label:x("In trash"),description:x("Only show files that are in the trash"),defaultOperator:_e.ne,control:{type:$e.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:x("Has shareable link"),description:x("Only show files that have a shareable link"),defaultOperator:_e.has,control:{type:$e.BooleanToggle,defaultValue:"*"}},{control:{type:$e.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:x("Shared by me"),description:x("Only show files that are shared with someone"),defaultOperator:_e.eq}],ci=Gs.map(e=>e.key);function di(){const e=b(l=>l.activePage),{isMobileMode:s}=f.useContext(oe),{trans:n}=B(),r=he(),[a]=Je(),[i,o]=f.useState(a.get("query")||"");return e!==ee?null:t.jsxs("div",{className:"mb-30 mt-10 px-10 md:px-26",children:[s&&t.jsx("form",{className:"contents",onSubmit:l=>{var c;l.preventDefault(),((c=document.activeElement)==null?void 0:c.tagName)==="INPUT"&&document.activeElement.blur(),r({pathname:ee.path,search:`?query=${i}`},{replace:!0})},children:t.jsx(Ce,{autoFocus:!0,className:"mb-20",startAdornment:t.jsx(L,{type:"submit",children:t.jsx(Ae,{})}),placeholder:n(x("Type to search")),value:i,onChange:l=>o(l.target.value)})}),t.jsx(Mr,{filters:Gs,pinnedFilters:ci})]})}function ui(e,s){const n={...e};n.left=Math.max(0,n.left);const r=n.left-e.left;r>0&&(n.width-=r),n.top=Math.max(0,n.top);const a=n.top-e.top;return a>0&&(n.height-=a),n.width=Math.min(n.width,s.width-n.left),n.height=Math.min(n.height,s.height-n.top),n}const ke=new Map;function mi(e){const{id:s,ref:n}=e,r=f.useRef(e);r.current=e,f.useLayoutEffect(()=>{if(n.current)return ke.set(s,{...ke.get(s),id:s,ref:n,onSelected:()=>{var a,i;(i=(a=r.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=r.current).onDeselected)==null?void 0:i.call(a)}}),()=>{ws.delete(s)}},[s,r,n])}function fi(e,s){return!e||!s?!1:e.left<=s.left+s.width&&e.left+e.width>=s.left&&e.top<=s.top+s.height&&e.top+e.height>=s.top}function hi({onPointerDown:e,...s}={}){const n=f.useRef(null),r=s.containerRef||n,a=f.useRef(null);let i=f.useRef({}).current;const o=()=>{var F,D,y,$,H,V,C;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const c=i.startPoint,u=i.endPoint,h=c.scrollTop||0,m=((F=r.current)==null?void 0:F.scrollTop)||0,g={left:Math.min(c.x,u.x),top:Math.min(c.y,u.y),width:Math.abs(c.x-u.x),height:Math.abs(c.y-u.y)};g.left-=i.boundaryRect.left,g.top-=i.boundaryRect.top,g.top+=h;const j=m-h,S=Math.abs(j);j<0&&(g.top-=S),g.height+=S;const v=i.boundaryRect?ui(g,i.boundaryRect):{...g};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${v.left}px, ${v.top}px)`,a.current.style.width=`${v.width}px`,a.current.style.height=`${v.height}px`),i.rafId=void 0}));const w={...v,left:v.left+i.boundaryRect.left,top:v.top+i.boundaryRect.top-m};for(const[,k]of ke){const re=fi(k.rect,w);re&&!((D=i.selectedIds)!=null&&D.has(k.id))?((y=i.selectedIds)==null||y.add(k.id),($=k.onSelected)==null||$.call(k)):!re&&((H=i.selectedIds)!=null&&H.has(k.id))&&((V=i.selectedIds)==null||V.delete(k.id),(C=k.onDeselected)==null||C.call(k))}};return{containerProps:{...Ss({minimumMovement:4,onPointerDown:e,onMoveStart:c=>{if(Cr)return!1;Ut(ke),i={selectedIds:new Set};const u=r.current;if(i.startPoint={x:c.clientX,y:c.clientY,scrollTop:(u==null?void 0:u.scrollTop)||0},i.scrollListener=h=>{var m;i.startPoint&&(Ut(ke),(m=i.boundaryRect)!=null&&m.height&&(i.boundaryRect.height=h.target.scrollHeight),o())},u){const h=u.getBoundingClientRect();u.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:h.top,left:h.left,height:u.scrollHeight,heightWithoutScroll:h.height,width:u.scrollWidth}}},onMove:c=>{if(i.endPoint={x:c.clientX,y:c.clientY},i.boundaryRect&&r.current){const u=c.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,h=c.clientY-20<i.boundaryRect.top;u?r.current.scrollBy({top:10}):h&&r.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),r.current&&i.scrollListener&&r.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:r},boxProps:{ref:a}}}function xi(e){return e?I.post(`file-entries/${e}/shareable-link`).then(s=>s.data):Promise.reject(new Error("Invalid entry id"))}function Zs(){return M({mutationFn:({entryId:e})=>xi(e),onSuccess:(e,{entryId:s})=>{A.setQueryData(T.fetchEntryShareableLink(s),e)},onError:e=>z(e,x("Could not create link"))})}function pi({entryIds:e}){return I.post("file-entries/star",{entryIds:e}).then(s=>s.data)}function gi(){return M({mutationFn:e=>pi(e),onSuccess:(e,{entryIds:s})=>{W(),N(x("Starred [one 1 item|other :count items]",{values:{count:s.length}}))},onError:e=>z(e,x("Could not star items"))})}function vi({entryIds:e}){return I.post("file-entries/unstar",{entryIds:e}).then(s=>s.data)}function ji(){return M({mutationFn:e=>vi(e),onSuccess:(e,{entryIds:s})=>{W(),N(x("Removed star from [one 1 item|other :count items]",{values:{count:s.length}}))},onError:e=>z(e,x("Could not remove star"))})}function yi(e){return I.post("file-entries/duplicate",e).then(s=>s.data)}function bi(){return M({mutationFn:e=>(N.loading(x("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),yi(e)),onSuccess:(e,s)=>{W(),A.invalidateQueries({queryKey:T.fetchStorageSummary}),N(x("Duplicated [one 1 item|other :count items]",{values:{count:s.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>z(e,x("Could not duplicate items"),null,{disableEnterAnimation:!0})})}function Xs(){return M({mutationFn:e=>wi(e),onSuccess:()=>W()})}function wi({entryIds:e,...s}){return I.post(`file-entries/${e.join(",")}/unshare`,s).then(n=>n.data)}function Js(){return M({mutationFn:e=>Si(e),onSuccess:(e,s)=>{W(),N(x("Restored [one 1 item|other :count items]",{values:{count:s.entryIds.length}}))},onError:e=>z(e,x("Could not restore items"))})}function Si(e){return I.post("file-entries/restore",e).then(s=>s.data)}function en(e){const s=tn(e),n=Mt(e),r=ki(e),a=Ii(e),i=Pi(e),o=Ei(e),l=Di(e),c=Ni(e),u=Fi(e),h=sn(e),m=nn(e),g=Mi(e);return[s,n,r,a,i,o,l,c,u,h,m,g].filter(j=>!!j)}function tn(e){if(e.some(s=>s.type!=="folder"))return{label:x("Preview"),icon:hr,key:"preview",execute:()=>{p().setActiveActionDialog("preview",e)}}}function Mt(e){const s=b(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||s===R))return{label:x("Share"),icon:ps,key:"share",execute:()=>{p().setActiveActionDialog("share",e)}}}function ki(e){const s=b(r=>r.activePage),n=Zs();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||s===R))return{label:x("Get link"),icon:Ar,key:"getLink",execute:()=>{n.mutate({entryId:e[0].id}),p().setActiveActionDialog("getLink",e)}}}function Ii(e){const s=b(r=>r.activePage),n=gi();if(!(e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||!e.every(r=>r.permissions["files.update"])||s===R))return{label:x("Add to starred"),icon:xr,key:"addToStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function Pi(e){const s=b(r=>r.activePage),n=ji();if(!(!e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||s===R))return{label:x("Remove from starred"),icon:pr,key:"removeFromStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function Ei(e){const s=b(n=>n.activePage);if(!(!e.every(n=>n.permissions["files.update"])||s===je||s===R))return{label:x("Move to"),icon:gr,key:"moveTo",execute:()=>{p().setActiveActionDialog("moveTo",e)}}}function Di(e){const s=b(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||s===R))return{label:x("Rename"),icon:vr,key:"rename",execute:()=>{p().setActiveActionDialog("rename",e)}}}function Ni(e){const s=b(r=>r.activePage),n=bi();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||s===R))return{label:x("Make a copy"),icon:jr,key:"makeCopy",execute:()=>{var r;n.mutate({entryIds:e.map(a=>a.id),destinationId:(r=s==null?void 0:s.folder)==null?void 0:r.id}),p().selectEntries([])}}}function Fi(e){const{downloadUrl:s}=ks(e[0],{downloadHashes:e.map(n=>n.hash)});if(e.every(n=>n.permissions["files.download"]))return{label:x("Download"),icon:He,key:"download",execute:()=>{s&&Ye(s),p().selectEntries([])}}}function sn(e){const s=qe(),n=b(r=>r.activePage);if(!(n===je||!e.every(r=>r.permissions["files.delete"])))return{label:n===R?x("Delete forever"):x("Remove"),icon:yt,key:"delete",execute:()=>{n===R?p().setActiveActionDialog("confirmAndDeleteForever",e):(s.mutate({entryIds:e.map(r=>r.id),deleteForever:n===R}),p().selectEntries([]))}}}function Mi(e){const s=Js();if(!(b(r=>r.activePage)!==R||!e.every(r=>r.permissions["files.delete"])))return{label:x("Restore"),icon:yr,key:"restore",execute:()=>{s.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function nn(e){const s=Xs();if(b(r=>r.activePage)===je)return{label:x("Remove"),icon:yt,key:"removeSharedEntry",execute:()=>{s.mutate({entryIds:e.map(r=>r.id),userId:"me"},{onSuccess:(r,a)=>{N(x("Removed [one 1 item|other {count} items]",{values:{count:a.entryIds.length}}))},onError:r=>z(r,x("Could not remove items"))}),p().selectEntries([])}}}function rn(e){const s=Ci(e),n=Ai(e),r=Ti(e),a=Li();return[s,n,r,a].filter(i=>!!i)}function Ci(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("New folder"),icon:vt,key:"newFolder",execute:()=>{e.folder&&p().setActiveActionDialog("newFolder",[e.folder])}}}function Ai(e){const{uploadFiles:s}=ze();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("Upload files"),icon:gs,key:"uploadFiles",execute:async()=>{s(await We({multiple:!0}))}}}function Ti(e){const{uploadFiles:s}=ze();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("Upload folder"),icon:vs,key:"uploadFolder",execute:async()=>{s(await We({directory:!0}))}}}function Li(e){const s=qe();if(b(r=>r.activePage)===R)return{label:x("Empty trash"),icon:br,key:"emptyTrash",execute:()=>{s.mutate({entryIds:[],emptyTrash:!0}),p().selectEntries([])}}}function rt({children:e,entries:s,page:n,showIfNoActions:r}){return(n==null?void 0:n.name)===q.name?t.jsx(Zt,{page:q,showIfNoActions:r,children:e}):n===R?t.jsx(Zt,{page:R,showIfNoActions:r,children:e}):n!=null&&n.folder?t.jsx(Gt,{entries:[n.folder],showIfNoActions:r,children:e}):s!=null&&s.length?t.jsx(Gt,{entries:s,showIfNoActions:r,children:e}):null}function Gt({entries:e,children:s,showIfNoActions:n}){const r=en(e);return t.jsx(an,{actions:r,showIfNoActions:n,children:s})}function Zt({page:e,children:s,showIfNoActions:n}){const r=rn(e);return t.jsx(an,{actions:r,showIfNoActions:n,children:s})}function an({actions:e,children:s,showIfNoActions:n}){return!e.length&&!n?null:t.jsxs(me,{children:[s,t.jsx(fe,{children:e.map(r=>t.jsx(_,{onSelected:()=>{r.execute()},value:r.key,startIcon:f.createElement(r.icon),children:t.jsx(d,{...r.label})},r.key))})]})}function Ct(){const e=Ys();return e.data?e.data.pages.flatMap(s=>s.data):[]}function At(){const e=b(n=>n.selectedEntries),s=Ct();return Array.from(e).map(n=>s.find(r=>r.id===n)).filter(n=>!!n)}function on(){return At()[0]}function Ri(){const e=on(),{data:s}=Os();if(!(!e||!(s!=null&&s.folders)))return s.folders.find(n=>n.id===e.parent_id)}function Tt(){const e=Array.from(p().selectedEntries),s=li();return e.map(n=>s.find(r=>r.id===n)).filter(n=>!!n)}function ln({className:e}){const s=At();return s.length?t.jsx("div",{className:e,children:t.jsx(zi,{entries:s})}):null}function zi({entries:e}){const s=tn(e),n=Mt(e),r=sn(e),a=nn(e),i=[s,n,r,a].filter(o=>!!o);return t.jsxs("div",{className:"entry-action-list",children:[i.map(o=>t.jsx(de,{label:t.jsx(d,{...o.label}),children:t.jsx(L,{size:"sm",onClick:()=>{o.execute()},children:f.createElement(o.icon)})},o.key)),t.jsx(rt,{entries:e,children:t.jsx(de,{label:t.jsx(d,{message:"More actions"}),children:t.jsx(L,{children:t.jsx(bt,{})})})})]})}function qi(){var a;const e=At(),s=b(i=>i.activePage),n=b(i=>i.contextMenuData),r=n!=null&&n.entry?[n.entry]:e;return((a=n==null?void 0:n.entry)==null?void 0:a.id)===0?t.jsx(Xt,{position:n,page:q}):n&&r.length?t.jsx(_i,{entries:r,position:n}):n&&s?t.jsx(Xt,{position:n,page:s}):null}function _i({entries:e,position:s}){const n=en(e);return t.jsx(cn,{position:s,actions:n})}function Xt({page:e,position:s}){const n=rn(e);return t.jsx(cn,{position:s,actions:n})}function cn({position:e,actions:s}){return t.jsx(Bn,{position:e,onOpenChange:n=>{n||p().setContextMenuData(null)},children:s.map(n=>t.jsx(_,{value:n.key,onSelected:n.execute,startIcon:f.createElement(n.icon),children:t.jsx(d,{...n.label})},n.key))})}function $i(){return Un("((pointer: coarse))")}function dn(e){const s=$i(),n=f.useRef(null),{onDrop:r}=Bs(e),[a,i]=f.useState(!1),o=b(m=>m.entriesBeingDragged.includes(e.id)),l=b(m=>m.activePage),{draggableProps:c}=ys({disabled:!!s||l===R,id:e.id,type:"fileEntry",ref:n,hidePreview:!0,onDragStart:(m,g)=>{p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setEntriesBeingDragged(g.getData().map(j=>j.id))},onDragEnd:()=>{p().setEntriesBeingDragged([])},getData:()=>Tt()}),{droppableProps:u}=tt({id:e.id,disabled:s||e.type!=="folder",ref:n,types:["fileEntry","nativeFile"],acceptsDrop:m=>lt(m,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:r});mi({id:e.id,ref:n,onSelected:()=>{p().selectEntries([e.id],!0)},onDeselected:()=>{p().deselectEntries([e.id])}});const h=P(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:c,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:h,ref:n}}function Oi({item:e,children:s,className:n,...r}){const{isCollapsedMode:a}=f.useContext(wt),{draggableProps:i,droppableProps:o,itemClassName:l,ref:c}=dn(e);return t.jsx("div",{className:P(n,l),ref:c,...Xe(i,o,r,{onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),a||(p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setContextMenuData({x:u.clientX,y:u.clientY}))}}),children:s})}function un(){const e=he();return{performViewItemAction:f.useCallback(n=>{if(n&&n.type==="folder")p().activePage===R?p().setActiveActionDialog("trashFolderBlock",[n]):e(nt(n.hash));else{const r=Tt();p().setActiveActionDialog("preview",r.length?r:[n])}},[e])}}const mn=Wn(e=>ve(e)),Lt=[{key:"name",allowsSorting:!0,header:()=>t.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>t.jsx(Ki,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>t.jsx(d,{message:"Last modified"}),body:e=>t.jsx(Ve,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>t.jsx(d,{message:"Size"}),maxWidth:"max-w-144",body:e=>mn(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>t.jsx(d,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>t.jsx(Bi,{entry:e})}];function Ki({entry:e}){const{isCollapsedMode:s}=f.useContext(wt),n=s?"w-30 h-30":"w-24 h-24";return t.jsxs("div",{className:"flex items-center gap-14",children:[t.jsx(St,{className:P("rounded",n),iconClassName:n,file:e}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),s&&t.jsxs("div",{className:"mt-4 flex items-center text-xs text-muted",children:[t.jsx(Ve,{date:e.updated_at}),t.jsx("div",{children:"·"}),t.jsx("div",{children:mn(e.file_size)})]})]})]})}function Bi({entry:e}){const{selectedRows:s}=f.useContext(wt);return s.length?t.jsx(us,{className:"mr-8 block",checked:s.includes(e.id)}):t.jsx(rt,{entries:[e],children:t.jsx(L,{className:"text-muted",children:t.jsx(bt,{})})})}function Ui({entries:e}){const{performViewItemAction:s}=un(),n=b(i=>i.selectedEntries),r=b(i=>i.sortDescriptor),a=f.useMemo(()=>[...n],[n]);return t.jsx(Is,{columns:Lt,data:e,sortDescriptor:r,onSortChange:i=>{p().setSortDescriptor(i)},onAction:s,selectedRows:a,selectionStyle:"highlight",renderRowAs:Oi,onSelectionChange:i=>{p().selectEntries(i)}})}const ct=Vn.forwardRef(({entry:e,className:s,isSelected:n,isMobileMode:r,footerAdornment:a,...i},o)=>t.jsxs("div",{...i,ref:o,className:P("grid-item flex aspect-square select-none flex-col overflow-hidden rounded border shadow outline-none transition-shadow-opacity dark:bg-alt",n&&"border-primary",s),children:[t.jsx("div",{className:"relative min-h-0 flex-auto",children:t.jsx(St,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),t.jsx(Wi,{entry:e,isSelected:n,isMobile:r,adornment:a})]}));function Wi({entry:e,isSelected:s,isMobile:n,adornment:r}){return t.jsxs("div",{className:P("flex h-48 flex-shrink-0 items-center text-sm",n?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",s&&"bg-primary-light/20"),children:[t.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),r]})}function Vi({entry:e}){B();const s=b(j=>j.selectedEntries.has(e.id)),{performViewItemAction:n}=un(),{isMobileMode:r}=f.useContext(oe),{draggableProps:a,droppableProps:i,itemClassName:o,ref:l}=dn(e),c=()=>{s?p().deselectEntries([e.id]):p().selectEntries([e.id],!0)},u=(j,S)=>{r?p().selectedEntries.size?c():n(e):Tr(j)?c():p().selectEntries([e.id])},{domProps:h}=Ss({onLongPress:r?()=>c():void 0,onPress:u}),m=j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),j.stopPropagation(),n(e))},g=j=>{j.preventDefault(),j.stopPropagation(),r||(p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setContextMenuData({x:j.clientX,y:j.clientY}))};return e.premium?t.jsxs("div",{className:"relative group",children:[t.jsx(ct,{entry:e}),t.jsx(Ze,{to:`/purchase/${e.id}`,className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",style:{cursor:"pointer"},children:t.jsx("span",{className:"text-white font-semibold text-sm",children:t.jsx(d,{message:"Purchase from original owner"})})})]}):t.jsx(ct,{...Xe(a,i,h,{onKeyDown:Ue(m)}),ref:l,isSelected:s,isMobileMode:!!r,tabIndex:-1,onDoubleClick:j=>{j.preventDefault(),j.stopPropagation(),r||n(e)},footerAdornment:r&&t.jsx(Qi,{entry:e,isSelected:s}),onContextMenu:Ue(g),entry:e,className:o})}function Qi({entry:e,isSelected:s}){return b(r=>r.selectedEntries.size)?t.jsx(us,{className:"mr-8 block",checked:s}):t.jsx(rt,{entries:[e],children:t.jsx(L,{className:"text-muted",onPointerDown:r=>{r.stopPropagation()},children:t.jsx(bt,{})})})}function Hi({entries:e}){return t.jsx("div",{className:"file-grid-container",children:t.jsx("div",{className:"file-grid",children:e.map(s=>t.jsx(Vi,{entry:s},s.id))})})}const Jt=[{id:"file_size",label:x("Size")},{id:"name",label:x("Name")},{id:"updated_at",label:x("Last modified")},{id:"created_at",label:x("Upload date")},{id:"type",label:x("Type")},{id:"extension",label:x("Extension")}];function fn({descriptor:e,onChange:s,isDisabled:n=!1}){const r=e.orderBy,a=e.orderDir,i=Jt.find(o=>o.id===r);return t.jsxs(me,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[a||"desc",r||""],onItemSelected:o=>{s(o==="asc"||o==="desc"?{orderBy:r,orderDir:o}:{orderBy:o,orderDir:a})},children:[t.jsx(E,{className:"text-muted",variant:"text",size:"sm",startIcon:t.jsx(wr,{}),disabled:n,children:i?t.jsx(d,{...i.label}):null}),t.jsxs(fe,{children:[t.jsxs(Kt,{label:t.jsx(d,{message:"Direction"}),children:[t.jsx(_,{value:"asc",children:t.jsx(d,{message:"Ascending"})}),t.jsx(_,{value:"desc",children:t.jsx(d,{message:"Descending"})})]}),t.jsx(Kt,{label:t.jsx(d,{message:"Sort By"}),children:Jt.map(o=>t.jsx(_,{value:o.id,children:t.jsx(d,{...o.label})},o.id))})]})]})}function hn({isDisabled:e}){const s=b(n=>n.sortDescriptor);return t.jsx(fn,{isDisabled:e,descriptor:s,onChange:n=>{p().setSortDescriptor(n)}})}function Rt({hash:e,params:s,isEnabled:n=!0}){return se({queryKey:T.fetchFolderPath(e,s),queryFn:()=>Yi(e,s),enabled:!!e&&n})}function Yi(e,s){return I.get(`folders/${e}/path`,{params:s}).then(n=>n.data)}function xn({className:e}){const{isMobileMode:s}=f.useContext(oe),n=he(),r=b(h=>h.activePage),a=r==null?void 0:r.folder,i=Rt({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==q.folder.hash}),o=mt(),l=Gi(),c=!r||!o||r.isFolderPage&&!a||i.fetchStatus!=="idle";let u;if(c)u=null;else{const h=l?[l]:[];i.data&&i.data.path.forEach(m=>{h.push({page:Et(m),label:m.name})}),u=t.jsx(kt,{className:e,size:s?"md":"lg",currentIsClickable:!0,children:h.map((m,g)=>g===h.length-1?t.jsx(Ie,{children:({isMenuItem:S})=>S||!m.page.folder&&m.page!==R?t.jsx(Ke,{value:m.label}):t.jsx(rt,{page:m.page,showIfNoActions:!0,children:t.jsxs(as,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[t.jsx(Ke,{value:m.label}),t.jsx(ut,{className:"text-muted icon-md"})]})})},m.page.uniqueId):t.jsx(Ie,{onSelected:()=>{n(m.page.path)},children:t.jsx(Ke,{value:m.label})},m.page.uniqueId))})}return u}function Gi(){var r,a;const e=b(i=>i.activePage),s=mt(),{user:n}=O();if(!e)return null;if(s&&!s.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.name)===q.name||((r=e.folder)==null?void 0:r.workspace_id)===s.id))return{label:s.name,page:q};if(e!=null&&e.isFolderPage){const i=(a=e.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(n==null?void 0:n.id)?{label:je.label,page:je}:{label:q.label,page:q}}return{label:e.label,page:e}}function pn({query:{isInitialLoading:e,fetchNextPage:s,isFetchingNextPage:n,hasNextPage:r},children:a,loaderMarginTop:i="mt-24",style:o,className:l,variant:c="infiniteScroll",loadMoreExtraContent:u,size:h="sm"}){const m=f.useRef(null),g=n||e,[j,S]=f.useState(0),v=c==="loadMore"&&j<3?"loadMore":"infiniteScroll",w=f.useRef(!1);f.useEffect(()=>{const D=m.current;if(!D||v==="loadMore")return;const y=new IntersectionObserver(([$])=>{if($.isIntersecting){if(!w.current)return;r&&!g&&(w.current=!1,s())}else w.current=!0});return y.observe(D),()=>{y.unobserve(D)}},[s,r,g,v]);let F;return a?F=n?a:null:v==="loadMore"?F=!e&&r&&t.jsxs("div",{className:P("flex items-center gap-8",i),children:[u,t.jsx(E,{size:h==="md"?"sm":"xs",className:P(h==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{s(),S(j+1)},disabled:g,children:j>=2&&!n?t.jsx(d,{message:"Load all"}):t.jsx(d,{message:"Show more"})})]}):F=t.jsx(J,{children:n&&t.jsx(K.div,{className:P("flex w-full justify-center",i),...ht,children:t.jsx(te,{size:h,isIndeterminate:!0,"aria-label":"loading"})})}),t.jsxs("div",{style:o,className:P("w-full",l,r&&"min-h-36"),role:"presentation",children:[t.jsx("div",{ref:m,"aria-hidden":!0}),F]})}function Zi({isVisible:e}){const s=t.jsx(K.div,{...ht,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:t.jsx(K.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:t.jsx(d,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return t.jsx(J,{children:e?s:null})}function Xi({className:e}){const[s]=Je(),n=!!s.get("query")||!!s.get("filters"),r=f.useRef(null),a=Ys(),i=Ct(),{uploadFiles:o}=ze(),l=qe(),c=b(y=>y.activePage),[u,h]=f.useState(!1),m=b(y=>y.viewMode),{isMobileMode:g}=f.useContext(oe),{containerProps:j,boxProps:S}=hi({containerRef:r,onPointerDown:y=>{y.target.closest(".entry-action-list")||p().deselectEntries("all")}}),{droppableProps:v}=tt({id:"driveRoot",ref:r,types:["nativeFile"],disabled:!(c!=null&&c.canUpload),onDragEnter:()=>{h(!0)},onDragLeave:()=>{h(!1)},onDrop:async y=>{y.type==="nativeFile"&&o(await y.getData())}});if(!c)return null;let w;if(!i.length&&(!a.isLoading||a.fetchStatus==="idle")){const y=c.noContentMessage(n);w=t.jsx(et,{className:"mt-40",image:t.jsx(Te,{src:y.image}),title:t.jsx(d,{...y.title}),description:t.jsx(d,{...y.description})})}else a.isLoading||(w=m==="list"?t.jsx(Ui,{entries:i}):t.jsx(Hi,{entries:i}));const F=y=>{y.preventDefault(),y.stopPropagation(),p().deselectEntries("all"),p().setContextMenuData({x:y.clientX,y:y.clientY})},D=y=>{y.key==="a"&&Lr(y)&&(y.preventDefault(),y.stopPropagation(),p().selectEntries(i.map($=>$.id))),y.key==="Delete"&&(y.preventDefault(),y.stopPropagation(),p().selectedEntries.size&&!l.isPending&&(c===R?p().setActiveActionDialog("confirmAndDeleteForever",Tt()):(l.mutate({entryIds:[...p().selectedEntries],deleteForever:c===R}),p().selectEntries([]))))};return t.jsx("div",{className:P("relative outline-none",e),tabIndex:-1,...Xe(j,v,{onKeyDown:Ue(D)}),onContextMenu:F,children:t.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[g?t.jsx(xn,{className:"mb-10 px-14"}):t.jsx(Ji,{}),t.jsx(di,{}),t.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[t.jsx(xt,{slot:"drive",className:"mb-24"}),w,t.jsx(pn,{query:a})]}),t.jsx("div",{...S,className:"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md"}),t.jsx(qi,{}),t.jsx(Zi,{isVisible:u})]})})}function Ji(){const e=b(s=>s.activePage);return t.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[t.jsx(hn,{isDisabled:e==null?void 0:e.disableSort}),t.jsx(ln,{className:"text-muted"})]})}const eo=f.memo(({file:e,style:s})=>t.jsxs("div",{className:"absolute left-0 top-0 flex w-full items-center gap-14 p-10",style:s,children:[t.jsx("div",{className:"shrink-0 rounded border p-8",children:t.jsx(Le,{className:"h-22 w-22",mime:e.mime})}),t.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[t.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:t.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.name})}),t.jsx(to,{file:e})]}),t.jsx("div",{className:"mr-10",children:t.jsx(so,{file:e})})]}));function to({file:e}){const s=ae(o=>o.fileUploads.get(e.id)),n=(s==null?void 0:s.bytesUploaded)||0,r=f.useMemo(()=>ve(e.size),[e]),a=f.useMemo(()=>ve(n),[n]);let i;return(s==null?void 0:s.status)==="completed"?i=t.jsx(d,{message:"Upload complete"}):(s==null?void 0:s.status)==="aborted"?i=t.jsx(d,{message:"Upload cancelled"}):(s==null?void 0:s.status)==="failed"?i=t.jsx(d,{message:"Upload failed"}):i=t.jsx(d,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:r}}),t.jsx("div",{className:"text-xs text-muted",children:i})}function so({file:e}){const s=ae(m=>m.fileUploads.get(e.id)),n=ae(m=>m.abortUpload),r=(s==null?void 0:s.percentage)||0,a=s==null?void 0:s.status,i=s==null?void 0:s.errorMessage,[o,l]=f.useState(!1),c=t.jsx(L,{size:"xs",iconSize:"sm",onClick:()=>{n(e.id)},children:t.jsx(we,{})}),u=t.jsx(te,{"aria-label":"Upload progress",size:"w-24 h-24",value:r,trackWidth:3});let h;if(a==="failed"){const m=i||x("This file could not be uploaded");h=t.jsx(Oe,{children:t.jsx(de,{variant:"danger",label:t.jsx(Ke,{value:m}),children:t.jsx(Qn,{className:"text-danger",size:"md"})})})}else a==="aborted"?h=t.jsx(Oe,{children:t.jsx(Hn,{className:"text-warning",size:"md"})}):a==="completed"?h=t.jsx(Oe,{children:t.jsx(Yn,{size:"md",className:"text-positive"})}):h=t.jsx(Oe,{onPointerEnter:m=>{m.pointerType==="mouse"&&l(!0)},onPointerLeave:m=>{m.pointerType==="mouse"&&l(!1)},children:o?c:u});return t.jsx(J,{children:h})}function Oe({children:e,...s}){return t.jsx(K.div,{...s,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function no(){const e=b(s=>s.uploadQueueIsOpen);return t.jsx(J,{children:e&&t.jsxs(K.div,{className:"fixed bottom-16 right-16 z-modal w-375 rounded border bg text-sm shadow-xl",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[t.jsx(ro,{}),t.jsx(ao,{})]},"upload-queue")})}function ro(){const e=ae(a=>a.activeUploadsCount),s=ae(a=>a.completedUploadsCount),n=ae(a=>a.clearInactive);let r;return e?r=t.jsx(d,{message:"Uploading :count files",values:{count:e}}):s?r=t.jsx(d,{message:"Uploaded :count files",values:{count:s}}):r=t.jsx(d,{message:"No active uploads"}),t.jsxs("div",{className:"flex min-h-[45px] items-center justify-between gap-10 border-b bg-alt px-10 py-4",children:[r,e===0?t.jsx(L,{size:"sm",onClick:()=>{p().setUploadQueueIsOpen(!1),setTimeout(()=>{n()},200)},children:t.jsx(we,{})}):void 0]})}function ao(){const e=ae(a=>a.fileUploads),s=[...e.values()],n=f.useRef(null),r=Rr({count:e.size,getScrollElement:()=>n.current,estimateSize:()=>60,overscan:4});return t.jsx("div",{className:"max-h-320 overflow-y-auto",ref:n,children:t.jsx("div",{className:"relative w-full",style:{height:`${r.getTotalSize()}px`},children:r.getVirtualItems().map(a=>{const i=s[a.index];return t.jsx(eo,{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},file:i.file},i.file.id)})})})}const io=""+new URL("detailed-examination-f7914cf1.svg",import.meta.url).href;function gn({entryType:e,entryName:s}){const{setRightSidenavStatus:n}=f.useContext(oe);return t.jsxs("div",{className:"mb-38 flex items-center gap-16 text-text-main",children:[t.jsx(Le,{className:"h-24 w-24",type:e}),t.jsx("div",{className:"mr-auto min-w-0 flex-auto text-ellipsis break-words text-xl font-normal",children:s}),t.jsx(L,{size:"md",className:"flex-shrink-0",onClick:()=>{n("closed")},children:t.jsx(we,{})})]})}function zt({children:e,margin:s="mb-20"}){return t.jsx("div",{className:P("text-base text-main",s),children:e})}function oo(e){return se({queryKey:vn(e),queryFn:()=>lo(e),initialData:e.initialData?{tags:e.initialData}:void 0})}function vn(e){const{taggableType:s,taggableId:n,type:r,notType:a}=e,i=["tags","taggable",s,`${n}`];return r!=null&&i.push(r),a!=null&&i.push(a),i}function jn({taggableType:e,taggableIds:s}){return Promise.allSettled(s.map(n=>A.invalidateQueries({queryKey:vn({taggableType:e,taggableId:n})})))}async function lo({taggableType:e,taggableId:s,notType:n,type:r}){return I.get(`taggable/${e}/${s}/list-tags`,{params:{notType:n,type:r}}).then(a=>a.data)}function yn(){return M({mutationFn:e=>co(e),onSuccess:(e,s)=>{jn(s)},onError:e=>z(e)})}function co(e){return I.post("taggable/detach-tag",e).then(s=>s.data)}function uo(e){return se({queryKey:["tags",e],queryFn:({signal:s})=>mo(e,s),placeholderData:pt})}async function mo(e,s){return e.query&&await new Promise(n=>setTimeout(n,300)),I.get("tags",{params:{paginate:"simple",...e},signal:e.query?s:void 0}).then(n=>n.data)}function fo(){return M({mutationFn:e=>ho(e),onSuccess:async(e,s)=>{jn(s)},onError:e=>z(e)})}function ho(e){return I.post("taggable/attach-tag",e).then(s=>s.data)}function xo({attachedTags:e,tagType:s,notTagType:n,taggableType:r,taggableIds:a,userId:i,isLoading:o,onChange:l}){const{trans:c}=B(),[u,h]=f.useState(""),{data:m,isPlaceholderData:g,isLoading:j}=uo({type:s,notType:n,query:u,userId:i}),S=yn(),v=fo(),{tags:w,attachedTagIds:F}=f.useMemo(()=>{const D=(m==null?void 0:m.pagination.data)||[],y=e||[],$=y.map(V=>V.id),H=D.filter(V=>!$.includes(V.id));return H.unshift(...y),{tags:H,attachedTagIds:$}},[e,m]);return t.jsx(ne,{children:t.jsxs(Z,{padding:"p-8",children:[t.jsx("form",{children:t.jsx(Ce,{placeholder:c({message:"Type tag name..."}),inputBorder:"border-b",inputRadius:"rounded-none",inputRing:"ring-0",inputShadow:"shadow-none",startAdornment:t.jsx(Ae,{}),value:u,onChange:D=>h(D.target.value),endAdornment:g&&t.jsx(te,{isIndeterminate:!0,size:"w-24 h-24"})})}),t.jsxs(ms,{className:"compact-scrollbar h-320 overflow-y-auto stable-scrollbar",children:[w.map(D=>{const y=F.includes(D.id),$=v.isPending||S.isPending||o;return t.jsx(ot,{isDisabled:$,onSelected:()=>{y?S.mutate({tagId:D.id,taggableIds:a,taggableType:r},{onSuccess:()=>l==null?void 0:l(D.id)}):v.mutate({taggableType:r,taggableIds:a,tagName:D.name,userId:i,tagType:s},{onSuccess:()=>l==null?void 0:l(D.id)})},className:P(y&&($?"text-primary-light":"text-primary")),startIcon:t.jsx(Bt,{size:"xs"}),endSection:y?t.jsx(is,{size:"sm",className:"block text-primary"}):t.jsx("div",{className:"h-20 w-20"}),children:D.display_name||D.name},D.id)}),!g&&!(m!=null&&m.pagination.data.length)&&u&&t.jsx(ot,{startIcon:t.jsx(Bt,{size:"xs"}),onSelected:()=>{v.mutate({taggableType:r,taggableIds:a,tagName:u,userId:i,tagType:s},{onSuccess:D=>{h(""),l==null||l(D.tag.id)}})},children:t.jsx(d,{message:'Create tag ":name"',values:{name:u}})}),m&&!w.length&&!u&&t.jsx("li",{className:"text-center text-muted",children:t.jsx(d,{message:"No tags found"})}),j&&t.jsx("li",{className:"flex justify-center",children:t.jsx(te,{isIndeterminate:!0,size:"w-24 h24"})})]})]})})}function po({entry:e}){var i;const{user:s}=O(),n=yn(),{data:r,isFetching:a}=oo({taggableType:"fileEntry",taggableId:e.id,initialData:(i=e.tags)==null?void 0:i.filter(o=>o.type!=="label"),type:"custom"});return t.jsxs("div",{className:"mt-20 border-t pt-20",children:[t.jsx(zt,{margin:"mb-10",children:t.jsx(d,{message:"Tags"})}),t.jsx("div",{className:"flex items-center gap-8",children:t.jsx(zr,{size:"sm",radius:"rounded-button",startButton:t.jsxs(ue,{type:"modal",children:[t.jsx(E,{variant:"outline",startIcon:t.jsx(jt,{}),size:"2xs",className:"min-h-26",children:t.jsx(d,{message:"Add tag"})}),t.jsx(xo,{attachedTags:r==null?void 0:r.tags,isLoading:a,tagType:"custom",taggableType:"fileEntry",taggableIds:[e.id],userId:s==null?void 0:s.id})]}),children:r==null?void 0:r.tags.map(o=>t.jsx(Gn,{disabled:n.isPending||a,onRemove:()=>{n.mutate({tagId:o.id,taggableIds:[e.id],taggableType:"fileEntry"})},children:o.display_name||o.name},o.id))})})]})}function go({entry:e}){return t.jsxs("div",{children:[t.jsx(gn,{entryType:e.type,entryName:e.name}),e.type==="image"&&t.jsx(St,{className:"mb-20",file:e}),t.jsxs("div",{children:[t.jsx(zt,{children:t.jsx(d,{message:"Who has access"})}),t.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?t.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-full border",children:t.jsx(Sr,{className:"icon-md"})}):null,e.users.map(s=>t.jsx(de,{label:s.name,children:t.jsx(dt,{src:s.image,size:"md",circle:!0})},s.id))]}),e.permissions["files.update"]&&t.jsx(E,{className:"mt-20 block",variant:"link",color:"primary",onClick:()=>{p().setActiveActionDialog("share",[e])},children:t.jsx(d,{message:"Manage Access"})})]}),t.jsx(vo,{entry:e}),t.jsx(po,{entry:e})]})}function vo({entry:e}){const s=Ri(),n=he(),r=e.users.find(i=>i.owns_entry),a=f.useMemo(()=>ve(e.file_size),[e.file_size]);return t.jsxs("div",{className:"mt-20 border-t pt-20",children:[t.jsx(zt,{children:t.jsx(d,{message:"Properties"})}),t.jsx(pe,{label:t.jsx(d,{message:"Type"}),value:t.jsx("span",{className:"capitalize",children:t.jsx(d,{message:e.type})})}),t.jsx(pe,{label:t.jsx(d,{message:"Size"}),value:e.file_size?a:"-"}),t.jsx(pe,{label:t.jsx(d,{message:"Location"}),value:t.jsx(E,{variant:"link",startIcon:t.jsx(Qe,{}),onClick:()=>{n(s?nt(s.hash):q.path)},children:s?s.name:t.jsx(d,{message:"Root"})})}),r&&t.jsx(pe,{label:t.jsx(d,{message:"Owner"}),value:r.name}),t.jsx(pe,{label:t.jsx(d,{message:"Modified"}),value:t.jsx(Ve,{date:e.updated_at})}),t.jsx(pe,{label:t.jsx(d,{message:"Created"}),value:t.jsx(Ve,{date:e.updated_at})})]})}function pe({label:e,value:s}){return t.jsxs("div",{className:"mb-14 flex items-center",children:[t.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),t.jsx("div",{className:"w-2/3 text-sm text-main",children:s})]})}function jo({className:e}){const s=on();return t.jsx("div",{className:P(e,"h-full overflow-y-auto border-l bg p-18 text-sm text-muted"),children:s?t.jsx(go,{entry:s}):t.jsx(yo,{})})}function yo(){return t.jsxs(f.Fragment,{children:[t.jsx(gn,{entryType:"folder",entryName:t.jsx(d,{message:"All files"})}),t.jsx(et,{image:t.jsx(Te,{src:io}),description:t.jsx(d,{message:"Select file or folder to see details here"})})]})}function bo(e){return M({mutationFn:s=>wo(s),onSuccess:(s,n)=>{W(),N(x(":oldName renamed to :newName",{values:{oldName:n.initialName,newName:s.fileEntry.name}}))},onError:s=>Pe(s,e)})}function wo({entryId:e,...s}){return I.put(`file-entries/${e}`,s).then(n=>n.data)}function So({entries:e}){var l;const{close:s,formId:n}=U(),r=(l=e[0])==null?void 0:l.name,a=Ee({defaultValues:{name:r}}),i=bo(a),o=c=>{i.mutate({entryId:e[0].id,name:c.name,initialName:r},{onSuccess:s})};return t.jsxs(ne,{children:[t.jsx(ie,{children:t.jsx(d,{message:"Rename"})}),t.jsx(Z,{children:t.jsx(De,{onSubmit:o,form:a,id:n,children:t.jsx(Ne,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),t.jsxs(ye,{children:[t.jsx(E,{variant:"flat",onClick:()=>s(),children:t.jsx(d,{message:"Cancel"})}),t.jsx(E,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending||!a.formState.isDirty,children:t.jsx(d,{message:"Save"})})]})]})}function ko({name:e,parentId:s}){return I.post("folders",{name:e,parentId:s===0?null:s}).then(n=>n.data)}function Io(e){return M({mutationFn:({name:s,parentId:n})=>ko({name:s,parentId:n}),onSuccess:()=>W(),onError:s=>Pe(s,e)})}function bn({parentId:e}){const{close:s,formId:n}=U(),{trans:r}=B(),a=Ee({defaultValues:{name:r({message:"Untitled Folder"})}}),i=Io(a),o=l=>{i.mutate({...l,parentId:e},{onSuccess:c=>{s(c.folder),N(x("Folder created"))}})};return t.jsxs(ne,{children:[t.jsx(ie,{children:t.jsx(d,{message:"New Folder"})}),t.jsx(Z,{children:t.jsx(De,{onSubmit:o,form:a,id:n,children:t.jsx(Ne,{placeholder:r({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),t.jsxs(ye,{children:[t.jsx(E,{variant:"flat",onClick:()=>s(),children:t.jsx(d,{message:"Cancel"})}),t.jsx(E,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending,children:t.jsx(d,{message:"Create"})})]})]})}function Po({selectedEntry:e}){const s=Ct().filter(i=>i.type!=="folder"),n=s.findIndex(i=>i.id===(e==null?void 0:e.id)),[r,a]=f.useState(n);return t.jsx(Ps,{allowDownload:e.permissions["files.download"],headerActionsLeft:t.jsx(Eo,{activeIndex:r,entries:s}),activeIndex:r,onActiveIndexChange:a,entries:s})}function Eo({activeIndex:e,entries:s}){const n=s[e],r=Mt([n]);return!n||!r?null:t.jsxs(f.Fragment,{children:[t.jsx(L,{className:"md:hidden",onClick:()=>{r.execute()},children:f.createElement(r.icon)}),t.jsx(E,{className:"max-md:hidden",variant:"text",startIcon:f.createElement(r.icon),onClick:()=>{r.execute()},children:t.jsx(d,{...r.label})})]})}function Do({entryId:e,...s}){return I.post(`file-entries/${e}/share`,s).then(n=>n.data)}function No(){return M({mutationFn:e=>Do(e),onSuccess:()=>{W()},onError:e=>{var s,n;if(Zn.isAxiosError(e)&&e.response){const r=e.response.data;(s=r.errors)!=null&&s.emails?N.danger((n=r.errors)==null?void 0:n.emails[0]):z(e)}}})}const Fo={edit:!0,view:!0,download:!0},ge=[{key:"view",value:{view:!0},label:x("Can view")},{key:"download",value:{view:!0,download:!0},label:x("Can Download")},{key:"edit",value:Fo,label:x("Can edit")}];function wn({value:e,onChange:s,isDisabled:n}){return t.jsxs(me,{selectedValue:e.key,selectionMode:"single",onSelectionChange:r=>{r!==e.key&&s(ge.find(a=>a.key===r))},children:[t.jsx(E,{variant:"flat",color:"chip",size:"xs",endIcon:t.jsx(ut,{}),disabled:n,children:t.jsx(d,{...e.label})}),t.jsx(fe,{children:ge.map(r=>t.jsx(_,{value:r.key,children:t.jsx(d,{...r.label})},r.key))})]})}function Mo(e){const{download:s,edit:n}=e.entry_permissions;return n?ge.find(r=>r.key==="edit"):s?ge.find(r=>r.key==="download"):ge.find(r=>r.key==="view")}function Co(){return M({mutationFn:e=>Ao(e),onSuccess:()=>{W(),N(x("Updated user permissions"))},onError:e=>z(e,x("Could not update permissions"))})}function Ao({entryId:e,...s}){return I.put(`file-entries/${e}/change-permissions`,s).then(n=>n.data)}function To({className:e,entry:s}){if(!s)return null;const n=s.users;return t.jsxs("div",{className:P(e,"overflow-hidden"),children:[t.jsx("div",{className:"mb-14 text-sm",children:t.jsx(d,{message:"Who has access"})}),t.jsx(J,{initial:!1,children:n.map(r=>t.jsx(Lo,{user:r,entry:s},r.id))})]})}function Lo({user:e,entry:s}){return t.jsxs(K.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-center gap-14 text-sm",children:[t.jsx(Xn,{user:e,circle:!0,size:"w-44 h-44"}),t.jsxs("div",{children:[t.jsx("div",{children:e.name}),t.jsx("div",{className:"text-muted",children:e.email})]}),t.jsx("div",{className:"ml-auto",children:e.owns_entry?t.jsx("span",{className:"text-muted",children:t.jsx(d,{message:"Owner"})}):t.jsx(Ro,{user:e,entry:s})})]},e.id)}function Ro({user:e,entry:s}){const n=Co(),r=Xs(),[a,i]=f.useState(()=>Mo(e));return t.jsxs("div",{className:"flex items-center gap-10",children:[t.jsx(wn,{isDisabled:n.isPending,onChange:o=>{n.mutate({userId:e.id,permissions:o.value,entryId:s.id}),i(o)},value:a}),t.jsx(L,{disabled:r.isPending,onClick:()=>{r.mutate({userId:e.id,entryIds:[s.id]},{onSuccess:()=>{N(x("Member removed"))},onError:o=>z(o,x("Could not remove member"))})},children:t.jsx(we,{})})]})}function zo({className:e,entry:s}){var V;const{trans:n}=B(),{share:r}=Me(),a=No(),[i,o]=f.useState([]),[l,c]=f.useState(!1),[u,h]=f.useState(!1),[m,g]=f.useState("0"),[j,S]=f.useState(ge[0]),[v,w]=f.useState(""),F=i.every(C=>!C.invalid),[D,y]=f.useState(""),$=qr("normalized-models/user",{perPage:7,query:D},{enabled:r==null?void 0:r.suggest_emails}),H=C=>C.description||C.name;return t.jsxs("div",{className:e,children:[t.jsx(js,{value:i,onChange:o,isAsync:!0,isLoading:$.fetchStatus==="fetching",inputValue:D,onInputValueChange:y,suggestions:(V=$.data)==null?void 0:V.results,displayWith:H,validateWith:C=>{const k=!Ls(C.description);return{...C,invalid:k,errorMessage:k?n({message:"Not a valid email"}):void 0}},placeholder:n({message:"Enter email addresses"}),label:t.jsx(d,{message:"Invite people"}),children:C=>t.jsx(_,{value:C.id,startIcon:t.jsx(dt,{circle:!0,src:C.image,alt:""}),description:C.description,children:C.name})}),i.length?t.jsxs("div",{className:"mt-14 flex items-center justify-between",children:[t.jsx("span",{children:n({message:"Scheduled at"})}),t.jsx("input",{type:"datetime-local",className:`w-[350px] appearance-none rounded-md border border-gray-300 bg-white px-5 py-2 pr-10 text-black placeholder-gray-500\r
             focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500\r
             dark:border-gray-600 dark:bg-black dark:text-white dark:placeholder-gray-400`,onChange:C=>{const k=C.target.value;if(!k)return;const re=new Date(k);if(re<new Date){N.danger(n({message:"Please select a future time"})),C.target.value="";return}const Y=re.toISOString();w(Y)}})]}):null,i.length?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"mt-14 flex items-center justify-between ",children:[t.jsx(st,{disabled:!1,onChange:()=>c(!l),children:t.jsx(d,{message:"Premium"})}),l&&t.jsx("input",{type:"number",onChange:C=>g(C.target.value),className:`appearance-none rounded-md border border-gray-300 bg-white px-5 py-2 pr-10 text-black placeholder-gray-500\r
             focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500\r
             dark:border-gray-600 dark:bg-black dark:text-white dark:placeholder-gray-400`,value:m})]})}):null,t.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[t.jsx(wn,{onChange:S,value:j}),i.length?t.jsx(E,{variant:"flat",color:"primary",size:"sm",disabled:u||!F,onClick:()=>{h(!0),a.mutate({emails:i.map(C=>H(C)),permissions:j.value,entryId:s.id,scheduledAt:v,premium:l,price:m},{onSuccess:()=>{o([])},onSettled:()=>{h(!1)}})},children:t.jsx(d,{message:"Share"})}):null]}),t.jsx(To,{className:"mt-30",entry:s})]})}function Sn(e){return se({queryKey:T.fetchEntryShareableLink(e),queryFn:()=>qo(e),enabled:!!e})}function qo(e){return I.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(s=>s.data)}function _o({entryId:e}){return I.delete(`file-entries/${e}/shareable-link`).then(s=>s.data)}function $o(){return M({mutationFn:({entryId:e})=>_o({entryId:e}),onSuccess:(e,{entryId:s})=>{A.setQueryData(T.fetchEntryShareableLink(s),{...e,link:null})},onError:e=>z(e,x("Could not delete link"))})}function Oo(e=36){let s="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r+=1)s+=n.charAt(Math.floor(Math.random()*n.length));return s}function Ko({setActivePanel:e,entry:s,focusInput:n}){var c,u;const r=Sn(s.id),a=!!((c=r.data)!=null&&c.link),i=Zs(),o=$o(),l=r.isLoading||i.isPending||o.isPending;return t.jsxs("div",{children:[t.jsx("div",{className:"mb-10",children:t.jsx(d,{message:"Share link"})}),t.jsxs("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:[t.jsx(st,{checked:a,disabled:l,onChange:()=>{a?o.mutate({entryId:s.id}):i.mutate({entryId:s.id})},children:a?t.jsx(d,{message:"Shareable link is created"}):t.jsx(d,{message:"Create shareable link"})}),a&&t.jsx(E,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:t.jsx(d,{message:"Link settings"})})]}),t.jsx(Bo,{autoFocus:n,link:(u=r.data)==null?void 0:u.link})]})}function Bo({link:e,autoFocus:s}){const{base_url:n}=Me(),{trans:r}=B(),a=Ba(),i=(e==null?void 0:e.hash)||(a==null?void 0:a.hash)||Oo(),o=`${n}/drive/s/${i}`,[l,c]=Jn(o,{successDuration:1e3});return t.jsx(Ce,{autoFocus:s,disabled:!e,className:"mt-10",readOnly:!0,value:o,"aria-label":r({message:"Shareable link"}),onFocus:u=>{u.target.select()},endAppend:t.jsx(E,{className:"min-w-100",variant:"flat",color:"primary",onClick:c,children:l?t.jsx(d,{message:"Copied!"}):t.jsx(d,{message:"Copy"})})})}function Uo({entryId:e,...s}){return I.put(`file-entries/${e}/shareable-link`,s).then(n=>n.data)}function Wo(e){return M({mutationFn:s=>Uo(s),onSuccess:(s,{entryId:n})=>{A.setQueryData(T.fetchEntryShareableLink(n),s)},onError:s=>Pe(s,e)})}function Vo({className:e,setActivePanel:s,entry:n}){const{formId:r}=U(),{data:a}=Sn(n.id),i=a==null?void 0:a.link,o=Ee({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:n.id}}),l=Wo(o);return t.jsxs(f.Fragment,{children:[t.jsx(ie,{onDismiss:()=>{s("main")},children:t.jsx(d,{message:"Shareable Link Settings"})}),t.jsx(Z,{children:t.jsx(K.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:t.jsxs(De,{id:r,className:e,form:o,onSubmit:c=>{l.mutate(c,{onSuccess:()=>{s("main"),N(x("Link settings saved"))}})},children:[t.jsx(Ho,{showField:!!(i!=null&&i.expires_at)}),t.jsx(Yo,{showField:!!(i!=null&&i.password)}),t.jsxs(Ge,{children:[t.jsx(d,{message:"Allow download"}),t.jsx(Qt,{name:"allowDownload",children:t.jsx(d,{message:"Users with link can download this item"})})]}),t.jsxs(Ge,{showBorder:!1,children:[t.jsx(d,{message:"Allow import"}),t.jsx(Qt,{name:"allowEdit",children:t.jsx(d,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),t.jsxs(ye,{children:[t.jsx(E,{type:"button",onClick:()=>{s("main")},children:t.jsx(d,{message:"Cancel"})}),t.jsx(E,{type:"submit",form:r,variant:"flat",color:"primary",disabled:l.isPending,children:t.jsx(d,{message:"Save"})})]})]})}const Qo=er(tr());function Ho({showField:e}){const{trans:s}=B(),[n,r]=f.useState(e);return t.jsxs(Ge,{children:[t.jsx(d,{message:"Link expiration"}),t.jsxs("div",{children:[t.jsx(st,{checked:n,onChange:a=>{r(a.target.checked)},children:t.jsx(d,{message:"Link is valid until"})}),n&&t.jsx(_r,{min:Qo,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":s({message:"Link expiration date and time"})})]})]})}function Yo({showField:e}){const{trans:s}=B(),[n,r]=f.useState(e);return t.jsxs(Ge,{children:[t.jsx(d,{message:"Password protect"}),t.jsxs("div",{children:[t.jsx(st,{checked:n,onChange:a=>{r(a.target.checked)},children:t.jsx(d,{message:"Users will need to enter password in order to view this link"})}),n&&t.jsx(Ne,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":s({message:"Link password"}),description:t.jsx(d,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:s({message:"Enter new password..."})})]})]})}function Ge({children:e,showBorder:s=!0}){const[n,r]=e;return t.jsxs("div",{className:P(s&&"mb-20 border-b pb-20"),children:[t.jsx("div",{className:"mb-8 text-sm font-medium",children:n}),r]})}function es({entry:e,focusLinkInput:s}){const{data:{fileEntry:n}}=se({queryKey:T.fetchFileEntry(e.id),queryFn:()=>I.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),initialData:{fileEntry:e}}),[r,a]=f.useState("main");return t.jsx(ne,{size:"lg",children:t.jsx(J,{initial:!1,mode:"wait",children:r==="linkSettings"?t.jsx(Vo,{setActivePanel:a,entry:n},"one"):t.jsx(Go,{setActivePanel:a,entry:n,focusLinkInput:s},"two")})})}function Go({setActivePanel:e,entry:s,focusLinkInput:n}){return t.jsxs(f.Fragment,{children:[t.jsx(ie,{children:t.jsx(d,{message:"Share ‘:name’",values:{name:s.name}})}),t.jsx(Z,{className:"relative",children:t.jsxs(K.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[t.jsx(zo,{className:"mb-30 border-b pb-30",entry:s}),t.jsx(Ko,{setActivePanel:e,entry:s,focusInput:!!n})]},"share-content")})]})}function Zo({query:e}){const{workspaceId:s}=X(),n=f.useMemo(()=>({section:"search",workspaceId:s,query:e,filters:Es([{key:"type",value:"folder"}])}),[s,e]);return se({queryKey:T.fetchEntries(n),queryFn:({signal:r})=>Xo(n,r),enabled:!!e,placeholderData:pt})}async function Xo(e,s){return e.query&&await new Promise(n=>setTimeout(n,300)),I.get("drive/file-entries",{params:e,signal:e.query?s:void 0}).then(n=>n.data)}function Jo({onFolderSelected:e}){const{trans:s}=B(),n=s({message:"Search folders"}),[r,a]=f.useState(""),{isFetching:i,data:o}=Zo({query:r}),l=o==null?void 0:o.data;return t.jsx(sr,{size:"sm",maxItems:10,placeholder:n,"aria-label":n,className:"pt-20",endAdornmentIcon:t.jsx(Ae,{}),isAsync:!0,isLoading:i,inputValue:r,onInputValueChange:a,blurReferenceOnItemSelection:!0,clearInputOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!1,children:l==null?void 0:l.map(c=>t.jsx(_,{value:c.id,textLabel:c.name,onSelected:()=>{e(c)},children:c.name},c.id))})}function el({selectedFolder:e,onFolderSelected:s}){const{data:n}=Rt({hash:e.hash,isEnabled:(e==null?void 0:e.hash)!==q.folder.hash});let r=null;return n!=null&&n.path&&(n.path.length===1?r=q.folder:r=n.path[n.path.length-2]),t.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[t.jsx(L,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!r,onClick:()=>{r&&s(r)},children:t.jsx(Wr,{})}),t.jsxs(kt,{size:"sm",className:"flex-auto",children:[t.jsxs(Ie,{onSelected:()=>{s(q.folder)},className:"flex items-center gap-8",children:[t.jsx(Qe,{className:"icon-sm"}),t.jsx(d,{message:q.folder.name})]}),n==null?void 0:n.path.map(a=>t.jsxs(Ie,{onSelected:()=>{s(a)},className:"flex items-center gap-8",children:[!a.id&&t.jsx(Qe,{className:"icon-sm"}),a.name]},a.id||"root"))]})]})}const tl=""+new URL("my-files-f7f7cfee.svg",import.meta.url).href;function sl({selectedFolder:e,movingSharedFiles:s}){const{workspaceId:n}=X(),r=f.useMemo(()=>{const a=Es([{key:"type",value:"folder"}]);return{section:"folder",folderId:e.hash=="0"&&s?"sharedWithMe":e.hash,workspaceId:n,filters:a}},[n,e.hash,s]);return It({queryKey:T.fetchEntries(r),queryFn:({pageParam:a=1})=>nl({...r,page:a}),initialPageParam:1,getNextPageParam:a=>{const i=a.current_page;if(bs(a))return i+1}})}function nl(e){return I.get("drive/file-entries",{params:e}).then(s=>s.data)}function rl({onFolderSelected:e,selectedFolder:s,movingSharedFiles:n}){var i,o,l;const r=sl({selectedFolder:s,movingSharedFiles:n});let a;return r.isLoading?a=t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx(te,{isIndeterminate:!0,size:"md"})}):((o=(i=r.data)==null?void 0:i.pages[0])==null?void 0:o.data.length)===0?a=t.jsx(et,{size:"xs",className:"pb-20 pt-64",image:t.jsx(Te,{src:tl}),title:t.jsx(d,{message:'There are no subfolders in ":folder"',values:{folder:s.name}})}):a=t.jsxs(f.Fragment,{children:[t.jsx(ms,{children:(l=r.data)==null?void 0:l.pages.flatMap(c=>c.data).map(c=>t.jsx(ot,{className:"min-h-48 border-b",onSelected:()=>{e(c)},startIcon:t.jsx(Le,{type:"folder"}),endIcon:t.jsx(Ur,{size:"md"}),children:c.name},c.id))}),t.jsx(pn,{query:r})]}),t.jsx("div",{className:"h-288 overflow-y-auto",children:a})}function al({entries:e}){const{user:s}=O(),n=b(o=>o.activePage),[r,a]=f.useState((n==null?void 0:n.folder)||q.folder),i=e.some(o=>{var l;return!((l=o.users.find(c=>c.id===s.id))!=null&&l.owns_entry)});return t.jsxs(ne,{size:"lg",children:[t.jsx(ie,{children:t.jsx(d,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),t.jsxs(Z,{children:[t.jsx("div",{className:"text-sm",children:t.jsx(d,{message:"Select a destination folder."})}),t.jsx(Jo,{onFolderSelected:a}),t.jsxs("div",{className:"mb-20 mt-40",children:[t.jsx(el,{selectedFolder:r,onFolderSelected:a}),t.jsx(rl,{movingSharedFiles:i,selectedFolder:r,onFolderSelected:a})]})]}),t.jsx(il,{selectedFolder:r,setSelectedFolder:a,entries:e})]})}function il({selectedFolder:e,setSelectedFolder:s,entries:n}){const{close:r}=U(),a=Ks();return t.jsxs(ye,{className:"border-t",startAction:t.jsxs(ue,{type:"modal",onClose:i=>{i&&s(i)},children:[t.jsx(E,{startIcon:t.jsx(vt,{}),variant:"text",children:t.jsx(d,{message:"New Folder"})}),t.jsx(bn,{parentId:e.id})]}),children:[t.jsx(E,{className:"max-md:hidden",variant:"flat",onClick:()=>r(),children:t.jsx(d,{message:"Cancel"})}),t.jsx(E,{type:"submit",variant:"flat",color:"primary",disabled:!Dt(n,e)||a.isPending,onClick:()=>{a.mutate({destinationId:e.id,entryIds:n.map(i=>i.id)},{onSuccess:r})},children:t.jsx(d,{message:"Move here"})})]})}function ol({entries:e}){const s=qe(),{close:n}=U(),r=e.length===1?t.jsx(d,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):t.jsx(d,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return t.jsx(be,{isDanger:!0,title:t.jsx(d,{message:"Delete forever?"}),body:r,confirm:t.jsx(d,{message:"Delete forever"}),isLoading:s.isPending,onConfirm:()=>{s.mutate({entryIds:e.map(a=>a.id),deleteForever:!0},{onSuccess:()=>{n(),p().selectEntries([])}})}})}function ll({entries:e}){const s=Js(),{close:n}=U();return t.jsx(be,{title:t.jsx(d,{message:"This folder is in your trash"}),body:t.jsx(d,{message:"To view this folder, restore it from the trash."}),confirm:t.jsx(d,{message:"Restore"}),isLoading:s.isPending,onConfirm:()=>{s.mutate({entryIds:e.map(r=>r.id)},{onSuccess:()=>{n(),p().selectEntries([])}})}})}function cl(){const e=b(n=>n.activeActionDialog),s=dl(e);return t.jsx(ue,{type:"modal",isOpen:!!s,onClose:()=>{p().setActiveActionDialog(null)},children:s})}function dl(e){var s;switch(e==null?void 0:e.name){case"rename":return t.jsx(So,{entries:e.entries});case"newFolder":return t.jsx(bn,{parentId:(s=e.entries[0])==null?void 0:s.id});case"preview":return t.jsx(Po,{selectedEntry:e.entries[0]});case"share":return t.jsx(es,{entry:e.entries[0]});case"getLink":return t.jsx(es,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return t.jsx(al,{entries:e.entries});case"confirmAndDeleteForever":return t.jsx(ol,{entries:e.entries});case"trashFolderBlock":return t.jsx(ll,{entries:e.entries});default:return null}}function ul(){const{trans:e}=B(),s=he(),n=b(o=>o.activePage),[r]=Je(),[a,i]=f.useState(r.get("query")||"");return t.jsx("form",{className:"max-w-620 flex-auto",onSubmit:o=>{o.preventDefault(),s({pathname:ee.path,search:`?query=${a}`},{replace:!0})},children:t.jsx(Ce,{size:"sm",background:"bg",value:a,onChange:o=>i(o.target.value),onFocus:()=>{n!==ee&&s(ee.path)},startAdornment:t.jsx(L,{type:"submit",children:t.jsx(Ae,{})}),className:"max-w-620 flex-auto",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function ml(e){const s=f.useRef(e),n=f.useId();f.useEffect(()=>(Wt.set(n,s.current),()=>{Wt.delete(n)}),[n])}function fl(){const e=f.useRef(null),[s,n]=f.useState(),[r,a]=f.useState({});ml({type:"fileEntry",onDragStart:(o,l)=>{const c=l;c&&(a({entries:c.getData(),e:o,draggingTreeItem:Qa(c.id)}),n({start:o}))},onDragMove:o=>{a(l=>({...l,e:o})),n(l=>({...l,end:o}))},onDragEnd:(o,l,c)=>{a({status:c})}});let i=null;return r.entries&&r.e&&(i=t.jsx("div",{ref:e,style:r.e?{transform:`translate(${r.e.x}px, ${r.e.y}px)`,width:`${r.e.rect.width}px`}:void 0,className:"pointer-events-none fixed left-0 top-0 isolate",children:r.entries.map((o,l)=>t.jsx(hl,{index:l,entry:o,points:s,state:r},o.id))})),t.jsx(J,{custom:r.status,children:i})}const hl=f.memo(({entry:e,points:s,index:n,state:r})=>{var h,m,g,j;const a=b(S=>S.viewMode),i=r.draggingTreeItem?Nt(e):e.id,o=ws.get(i);if(!(o!=null&&o.rect)||!(s!=null&&s.start))return null;const l=o.rect,c=((h=r.entries)==null?void 0:h.length)||0,u=S=>{var v,w,F;return S==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((v=s.end)==null?void 0:v.x)||0),y:l.top-(((w=s.end)==null?void 0:w.y)||0),width:`${(F=r.e)==null?void 0:F.rect.width}px`}};return t.jsxs(K.div,{transition:{delay:.01*n,bounce:0,duration:.2},initial:{x:l.left-s.start.x,y:l.top-s.start.y,width:`${(m=r.e)==null?void 0:m.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:u,style:{width:a==="grid"?`${(g=r.e)==null?void 0:g.rect.width}px`:void 0,height:`${(j=r.e)==null?void 0:j.rect.height}px`},className:P("absolute max-h-48 whitespace-nowrap rounded border border-primary-light bg-paper",n<2&&"shadow",n===0&&"left-0 top-0 z-10",n>0&&"left-6 top-6"),children:[c>1&&n===0&&t.jsx(xl,{count:c}),t.jsxs("div",{className:"flex h-full items-center justify-center gap-10 overflow-hidden bg-primary-light/20 px-16 text-sm",children:[t.jsx(Le,{type:e.type}),t.jsx("div",{className:"flex-auto overflow-hidden text-ellipsis",children:e.name})]})]},e.id)}),xl=f.memo(({count:e})=>t.jsx(K.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -right-6 -top-6 z-10 z-30 flex h-20 w-20 items-center justify-center rounded-full bg-danger text-sm font-bold text-white shadow-lg",children:e},"entryCount"));function kn({children:e,className:s}){return t.jsx("div",{className:P(s,"dashboard-grid-header"),children:e})}function pl(){const{isMobileMode:e}=f.useContext(oe),s=b(n=>n.activePage);return t.jsxs(kn,{className:"flex h-60 items-center gap-20 border-b px-8 py-4 md:px-26",children:[e?t.jsx(hn,{isDisabled:s==null?void 0:s.disableSort}):t.jsx(xn,{}),t.jsxs("div",{className:"ml-auto flex-shrink-0 text-muted",children:[t.jsx(gl,{}),t.jsx(vl,{})]})]})}function gl(){const e=b(n=>n.viewMode),s=e==="grid"?t.jsx(d,{message:"List view"}):t.jsx(d,{message:"Grid view"});return t.jsx(de,{label:s,children:t.jsx(L,{size:"md",onClick:()=>{p().setViewMode(p().viewMode==="list"?"grid":"list")},children:e==="list"?t.jsx(kr,{}):t.jsx(Ir,{})})})}function vl(){const{rightSidenavStatus:e,setRightSidenavStatus:s}=f.useContext(oe),n=e?t.jsx(d,{message:"Hide details"}):t.jsx(d,{message:"Show details"});return t.jsx(de,{label:n,children:t.jsx(L,{size:"md",color:e==="open"?"primary":null,onClick:()=>{s(e==="open"?"closed":"open")},children:t.jsx($r,{})})})}const jl={modifyUploadedFile:e=>{const s=ds();return e.fingerprint=`${e.fingerprint}-w-${s}`,e}};function Ul(){const{pathname:e}=fs(),{hash:s}=gt(),{workspaceId:n}=X(),r=b(i=>i.activePage);f.useEffect(()=>{p().setActivePage($a.find(i=>i.path===e)||qs(s))},[e,s]);const a=f.useMemo(()=>({workspaceId:n}),[n]);return f.useEffect(()=>()=>{p().reset()},[]),t.jsxs(f.Fragment,{children:[(r==null?void 0:r.label)&&t.jsx(nr,{children:t.jsx(d,{message:typeof r.label=="string"?r.label:r.label.message})}),t.jsxs(hs,{options:jl,children:[t.jsx(Ds.Provider,{value:a,children:t.jsxs(Ns,{name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[t.jsx(yl,{}),t.jsx(Vt,{position:"left",size:"md",children:t.jsx(ri,{})}),t.jsx(pl,{}),t.jsx(Fs,{children:t.jsx(Xi,{})}),t.jsx(no,{}),t.jsx(cl,{}),t.jsx(Vt,{position:"right",size:"lg",children:t.jsx(jo,{})})]})}),t.jsx(fl,{})]})]})}function yl(){const{isMobileMode:e}=f.useContext(oe),s=b(i=>i.activePage),n=e?null:t.jsx(ul,{}),r=t.jsx(L,{elementType:Ze,to:ee.path,children:t.jsx(Ae,{})}),a=t.jsxs(f.Fragment,{children:[s!==ee&&r,t.jsx(Hs,{isCompact:!0})]});return t.jsxs(f.Fragment,{children:[t.jsx(Ms,{rightChildren:e&&a,menuPosition:"drive-navbar",children:n}),e&&t.jsx(bl,{})]})}function bl(){const e=b(s=>s.selectedEntries.size);return e?t.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[t.jsx(L,{onClick:()=>{p().selectEntries([])},children:t.jsx(we,{})}),t.jsx(d,{message:":count selected",values:{count:e}}),t.jsx(ln,{className:"ml-auto"})]}):null}const Q=ls()(cs(e=>({password:null,viewMode:Be("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:s=>{e(n=>{n.password=s})},isPasswordProtected:!1,setIsPasswordProtected:s=>{e(n=>{n.isPasswordProtected=s})},setViewMode:s=>{e(n=>{n.viewMode=s,it("drive.viewMode",s)})},setActiveSort:s=>{e(n=>{n.activeSort=s})}})));function ce(){return Q.getState()}function le(){var l,c;const{hash:e}=gt(),{orderBy:s,orderDir:n}=Q(u=>u.activeSort),r=`${s}:${n}`,a=Q(u=>u.isPasswordProtected),i=Q(u=>u.password),o=It({queryKey:T.fetchShareableLink({hash:e,sort:r}),queryFn:async({pageParam:u=1})=>{const h=await wl({hash:e,page:u,order:r,password:i});return h.passwordInvalid&&ce().setIsPasswordProtected(!0),h},initialData:()=>{var h,m;const u=(h=ft().loaders)==null?void 0:h.shareableLinkPage;if(u&&((m=u.link)==null?void 0:m.hash)===e)return u.passwordInvalid&&ce().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[u]}},initialPageParam:1,getNextPageParam:u=>{if(!u.folderChildren)return;const h=u.folderChildren.current_page,m=u.folderChildren.last_page;if(!(h>=m))return h+1},enabled:!!e&&!a||i!=null,placeholderData:pt});return{...o,link:(l=o.data)==null?void 0:l.pages[0].link,entries:(c=o.data)==null?void 0:c.pages.flatMap(u=>{var h;return(h=u.folderChildren)==null?void 0:h.data})}}function wl({hash:e,page:s=1,order:n,password:r}){return I.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:s,order:n,password:r}}).then(a=>a.data)}function Sl({password:e,linkHash:s}){return I.post(`shareable-links/${s}/check-password`,{password:e}).then(n=>n.data)}function kl(){return M({mutationFn:e=>Sl(e),onSuccess:(e,s)=>{e.matches&&ce().setPassword(s.password)},onError:e=>z(e,x("Could not create link"))})}function Il({linkId:e,password:s}){return I.post(`shareable-links/${e}/import`,{password:s}).then(n=>n.data)}function Pl(){const e=Q(s=>s.password);return M({mutationFn:s=>Il({...s,password:e}),onSuccess:async()=>{await A.invalidateQueries({queryKey:T.fetchShareableLink()}),N(x("Item imported into your drive"))},onError:s=>z(s,x("Could not create link"))})}function In(){var o;const{link:e}=le(),{user:s,isLoggedIn:n}=O(),{downloadUrl:r}=ks(e==null?void 0:e.entry),a=Pl(),i=(o=e==null?void 0:e.entry)==null?void 0:o.users.find(l=>l.id===(s==null?void 0:s.id));return e!=null&&e.entry?t.jsxs("div",{children:[e.allow_download&&t.jsx(El,{downloadUrl:r}),!i&&n&&e.allow_edit&&t.jsxs(me,{onItemSelected:l=>{l==="import"?a.mutate({linkId:e.id}):l==="download"&&r&&Ye(r)},children:[t.jsx(L,{className:"ml-6",disabled:a.isPending,children:t.jsx(os,{})}),t.jsxs(fe,{children:[t.jsx(_,{value:"download",startIcon:t.jsx(He,{}),children:t.jsx(d,{message:"Download"})}),t.jsx(_,{value:"import",startIcon:t.jsx(Pr,{}),children:t.jsx(d,{message:"Save a copy to your own drive"})})]})]})]}):null}function El({downloadUrl:e}){return t.jsxs(f.Fragment,{children:[t.jsx(de,{label:t.jsx(d,{message:"Download"}),children:t.jsx(L,{className:"md:hidden",onClick:()=>{e&&Ye(e)},children:t.jsx(He,{})})}),t.jsx(E,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:t.jsx(He,{}),onClick:()=>{e&&Ye(e)},children:t.jsx(d,{message:"Download"})})]})}function Pn(){const{link:e}=le(),s=xs();return t.jsx(rr,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&t.jsx(In,{}),menuPosition:"shareable-link-page",hideLogo:s,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&t.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[t.jsx(Le,{className:"flex-shrink-0",type:e.entry.type}),t.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.entry.name})]})})}function Dl(){const{trans:e}=B(),{hash:s}=gt(),n=e({message:"Password"}),[r,a]=f.useState(""),i=kl(),o=s?s.split(":")[0]:null,l=i.data&&!i.data.matches;return t.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[t.jsx(Pn,{}),t.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:t.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[t.jsx("div",{className:"h-132 w-[165px]",children:t.jsx(Te,{src:ar})}),t.jsxs("form",{onSubmit:c=>{c.preventDefault(),i.mutate({linkHash:o,password:r})},children:[t.jsx("span",{className:"text-sm",children:t.jsx(d,{message:"The link you are trying to access is password protected."})}),t.jsx(Ce,{autoFocus:!0,placeholder:n,"aria-label":n,className:"mb-20 mt-10",type:"password",value:r,required:!0,errorMessage:l&&t.jsx(d,{message:"Password is not valid"}),onChange:c=>{a(c.target.value)}}),t.jsx("div",{className:"text-right",children:t.jsx(E,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isPending,children:t.jsx(d,{message:"Enter"})})})]})]})})]})}function Nl({entries:e,onEntrySelected:s}){return t.jsx("div",{className:"file-grid",children:e.map((n,r)=>t.jsx(ct,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:n,onContextMenu:a=>{a.preventDefault()},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&s(n,r)},onClick:()=>{s(n,r)}},n.id))})}const Fl=Lt.filter(e=>e.key!=="updated_at");function Ml({entries:e,onEntrySelected:s}){const n=Q(a=>a.activeSort),r=xs();return t.jsx(Is,{columns:r?Fl:Lt,data:e,sortDescriptor:n,onSortChange:a=>{ce().setActiveSort(a)},onAction:(a,i)=>{s(a,i)},enableSelection:!1})}function Cl(e,s){var r;let n=e.hash;return s&&((r=e.entry)==null?void 0:r.hash)!==s&&(n=`${n}:${s}`),n}function En(){const{link:e}=le(),s=ir();return n=>{e&&s(`/drive/s/${Cl(e,n)}`)}}function Al({className:e}){const{pathname:s}=fs(),n=En(),[r,a]=f.useState(),i=Q(v=>v.viewMode),o=f.useRef(null),{link:l,entries:c,isFetchingNextPage:u,hasNextPage:h,fetchNextPage:m,isPlaceholderData:g}=le();if(f.useEffect(()=>{a(void 0)},[s]),f.useEffect(()=>{const v=o.current;if(!v)return;const w=new IntersectionObserver(([F])=>{F.isIntersecting&&h&&m()});return w.observe(v),()=>{w.unobserve(v)}},[h,m]),!l||g)return t.jsx("div",{className:P("flex justify-center",e),children:t.jsx(te,{isIndeterminate:!0})});const j=(v,w)=>{v.type==="folder"?n(v.hash):a(w)},S=c||[];return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:P("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",e),children:[t.jsx(xt,{slot:"file-preview",className:"mb-40"}),i==="grid"?t.jsx(Nl,{entries:S,onEntrySelected:j}):t.jsx(Ml,{entries:S,onEntrySelected:j}),t.jsx("span",{ref:o,"aria-hidden":!0}),t.jsx(J,{children:u&&t.jsx(K.div,{className:"mt-24 flex w-full justify-center",...ht,children:t.jsx(te,{isIndeterminate:!0,"aria-label":"loading"})})})]}),t.jsx(ue,{type:"modal",isOpen:r!=null,onClose:()=>a(void 0),children:t.jsx(Ps,{entries:S,defaultActiveIndex:r,allowDownload:l.allow_download})})]})}function Tl({className:e,folder:s,link:n}){const r=En(),a=Q(l=>l.password),i=Rt({hash:s==null?void 0:s.hash,params:{shareable_link:n.id,password:a}});let o;if(i.isLoading)o=null;else{const l=[];i.data&&i.data.path.forEach(c=>{l.push({folder:c,label:t.jsx(t.Fragment,{children:c.name})})}),o=t.jsx(kt,{size:"lg",isNavigation:!0,children:l.map(c=>t.jsx(Ie,{onSelected:()=>{r(c.folder.hash)},children:c.label},c.folder.hash))})}return t.jsx("div",{className:P("h-36 flex-shrink-0",e),children:o})}function Ll(){const e=Q(a=>a.activeSort),{link:s,isFetching:n}=le(),r=s&&s.entry;return t.jsxs("div",{className:"flex flex-col justify-between gap-14 p-14 md:h-90 md:flex-row md:items-center md:p-24",children:[r&&t.jsx(Tl,{link:s,folder:s.entry,className:"flex-auto"}),r&&t.jsxs("div",{className:"flex items-center justify-between text-muted md:justify-start",children:[t.jsx(fn,{isDisabled:n,descriptor:e,onChange:a=>{ce().setActiveSort(a)}}),t.jsx("div",{className:"ml-10 md:border-l md:pl-10",children:t.jsx(L,{onClick:()=>{ce().setViewMode(ce().viewMode==="grid"?"list":"grid")},children:t.jsx(Er,{})})})]})]})}function Rl(){const{entries:e,isFetched:s}=le(),n=s&&!(e!=null&&e.length);return t.jsxs(Ns,{name:"folder-preview",children:[t.jsx(Ms,{hideToggleButton:!0,rightChildren:t.jsx(In,{}),color:"bg"}),t.jsx(kn,{children:t.jsx(Ll,{})}),t.jsx(hs,{children:t.jsx(Fs,{children:n?t.jsx(zl,{}):t.jsx(Al,{})})})]})}function zl({className:e}){return t.jsx(et,{className:P(e,"mt-80"),image:t.jsx(Te,{src:zs}),title:t.jsx(d,{message:"Folder is empty"}),description:t.jsx(d,{message:"No files have been uploaded to this folder yet"})})}function ql(){const{link:e}=le();return e!=null&&e.entry?t.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[t.jsx(Pn,{}),t.jsx(xt,{slot:"file-preview",className:"mx-auto mt-24"}),t.jsx(Or,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function Wl(){var o;const{status:e,link:s}=le(),{trans:n}=B(),r=Q(l=>l.isPasswordProtected),a=Q(l=>l.password);let i;if(e==="pending")i=t.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:t.jsx(te,{"aria-label":n({message:"Loading link"}),isIndeterminate:!0})});else{if(!s&&!r)return t.jsx(or,{});r&&!a?i=t.jsx(Dl,{}):((o=s==null?void 0:s.entry)==null?void 0:o.type)==="folder"?i=t.jsx(Rl,{}):i=t.jsx(ql,{})}return t.jsx(lr,{children:t.jsx(Ds.Provider,{value:{shareable_link:s==null?void 0:s.id,password:a},children:i})})}export{Ul as DriveLayout,Wl as ShareableLinkPage};
//# sourceMappingURL=drive-routes.lazy-7520faf3.js.map
