import{r as d,b9 as V,j as t,b2 as J,T as h,N as X,aw as I,ba as ee,b1 as N,m as T,aS as te,n as y,V as z,bb as se,bc as re,bd as B,aK as ae,be as $,bf as O,u as _,bg as U,bh as F,as as ne,ay as G,w as p}from"./main-d9541150.js";import{S as K,l as ie,B as M}from"./billing-redirect-message-ff84d879.js";import"./TaskAlt-4b7d291f.js";function k({children:e}){const[s,r]=e;return d.useEffect(()=>{V("be.onboarding.selected")},[]),t.jsxs(d.Fragment,{children:[t.jsx(J,{children:t.jsx(h,{message:"Checkout"})}),t.jsx(X,{size:"sm",color:"transparent",className:"z-10 mb-20 md:mb-0",textColor:"text-main",logoColor:"dark",darkModeColor:"transparent",menuPosition:"checkout-page-navbar"}),t.jsxs("div",{className:"mx-auto w-full justify-between px-20 md:flex md:max-w-950 md:px-0 md:pt-128",children:[t.jsx("div",{className:"fixed right-0 top-0 hidden h-full w-1/2 bg-alt shadow-[15px_0_30px_0_rgb(0_0_0_/_18%)] md:block"}),t.jsxs("div",{className:"overflow-hidden md:w-400",children:[s,t.jsx(I,{menu:"checkout-page-footer",className:"mt-50 overflow-x-auto text-xs text-muted"}),t.jsx("div",{className:"mt-40",children:t.jsx(ee,{})})]}),t.jsx("div",{className:"hidden w-384 md:block",children:t.jsx("div",{className:"relative z-10",children:r})})]})]})}const W=e=>`billing/products/${e}`;function ce(){var i;const{productId:e,priceId:s}=N(),r=T({queryKey:[W(e)],queryFn:()=>oe(e),placeholderData:te,enabled:e!=null&&s!=null}),a=(i=r.data)==null?void 0:i.product,c=(a==null?void 0:a.prices.find(n=>n.id===parseInt(s)))||(a==null?void 0:a.prices[0]);return{status:r.status,product:a,price:c}}function oe(e){return y.get(W(e)).then(s=>s.data)}function R({showBillingLine:e=!0}){const{status:s,product:r,price:a}=ce();return s==="error"||s!=="pending"&&(!r||!a)?null:t.jsxs("div",{children:[t.jsx("h2",{className:"mb-30 text-2xl",children:t.jsx(h,{message:"Summary"})}),s==="pending"?t.jsx(le,{},"loading-skeleton"):t.jsx(ue,{product:r,price:a,showBillingLine:e})]})}function ue({product:e,price:s,showBillingLine:r}){return t.jsxs(z.div,{children:[t.jsx("div",{className:"mb-6 text-xl font-semibold",children:e.name}),e.description&&t.jsx("div",{className:"text-sm text-muted",children:e.description}),t.jsx(se,{priceClassName:"font-bold text-4xl",periodClassName:"text-muted text-xs",variant:"separateLine",price:s,className:"mt-32"}),t.jsx(re,{product:e}),r&&t.jsxs("div",{className:"mt-32 flex items-center justify-between gap-24 border-t pt-24 font-medium",children:[t.jsx("div",{children:t.jsx(h,{message:"Billed today"})}),t.jsx("div",{children:t.jsx(B,{value:s.amount,currency:s.currency})})]})]})}function le(){return t.jsxs(z.div,{...ae,className:"max-w-180",children:[t.jsx($,{className:"mb-6 text-xl"}),t.jsx($,{className:"text-sm"}),t.jsx($,{className:"mt-32 text-4xl"})]})}/*!
 * paypal-js v7.0.3 (2023-09-19T14:17:47.731Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(e,s){var r=document.querySelector('script[src="'.concat(e,'"]'));if(r===null)return null;var a=Q(e,s),c=r.cloneNode();if(delete c.dataset.uidAuto,Object.keys(c.dataset).length!==Object.keys(a.dataset).length)return null;var i=!0;return Object.keys(c.dataset).forEach(function(n){c.dataset[n]!==a.dataset[n]&&(i=!1)}),i?r:null}function fe(e){var s=e.url,r=e.attributes,a=e.onSuccess,c=e.onError,i=Q(s,r);i.onerror=c,i.onload=a,document.head.insertBefore(i,document.head.firstElementChild)}function pe(e){var s="https://www.paypal.com/sdk/js";e.sdkBaseUrl&&(s=e.sdkBaseUrl,delete e.sdkBaseUrl);var r=e,a=Object.keys(r).filter(function(n){return typeof r[n]<"u"&&r[n]!==null&&r[n]!==""}).reduce(function(n,o){var f=r[o].toString();return o=he(o),o.substring(0,4)==="data"?n.dataAttributes[o]=f:n.queryParams[o]=f,n},{queryParams:{},dataAttributes:{}}),c=a.queryParams,i=a.dataAttributes;return c["merchant-id"]&&c["merchant-id"].indexOf(",")!==-1&&(i["data-merchant-id"]=c["merchant-id"],c["merchant-id"]="*"),{url:"".concat(s,"?").concat(me(c)),dataAttributes:i}}function he(e){var s=function(r,a){return(a?"-":"")+r.toLowerCase()};return e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,s)}function me(e){var s="";return Object.keys(e).forEach(function(r){s.length!==0&&(s+="&"),s+=r+"="+e[r]}),s}function Q(e,s){s===void 0&&(s={});var r=document.createElement("script");return r.src=e,Object.keys(s).forEach(function(a){r.setAttribute(a,s[a]),a==="data-csp-nonce"&&r.setAttribute("nonce",s["data-csp-nonce"])}),r}function be(e,s){if(s===void 0&&(s=Promise),H(e,s),typeof document>"u")return s.resolve(null);var r=pe(e),a=r.url,c=r.dataAttributes,i=c["data-namespace"]||"paypal",n=q(i);return de(a,c)&&n?s.resolve(n):xe({url:a,attributes:c},s).then(function(){var o=q(i);if(o)return o;throw new Error("The window.".concat(i," global variable is not available."))})}function xe(e,s){s===void 0&&(s=Promise),H(e,s);var r=e.url,a=e.attributes;if(typeof r!="string"||r.length===0)throw new Error("Invalid url.");if(typeof a<"u"&&typeof a!="object")throw new Error("Expected attributes to be an object.");return new s(function(c,i){if(typeof document>"u")return c();fe({url:r,attributes:a,onSuccess:function(){return c()},onError:function(){var n=new Error('The script "'.concat(r,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return i(n)}})})}function q(e){return window[e]}function H(e,s){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");if(typeof s<"u"&&typeof s!="function")throw new Error("Expected PromisePonyfill to be a function.")}function Y({productId:e,priceId:s,type:r,entry_id:a,entry_price:c}){const{data:i}=O(),n=d.useRef(!1),o=d.useRef(!1),[f,l]=d.useState(!1),m=d.useRef(null),{base_url:b,billing:{stripe:{enable:x},paypal:{enable:u,public_key:v}}}=_();return d.useEffect(()=>{!u||!v||n.current||(be({clientId:v,intent:r,vault:!0,disableFunding:x?"card":void 0}).then(()=>{l(!0)}),n.current=!0)},[v,u,x]),d.useEffect(()=>{var A;if(!f||!((A=window.paypal)!=null&&A.Buttons)||!m.current||!(i!=null&&i.products.length)||!e||!s||o.current)return;const w=i.products.find(g=>g.id===parseInt(e)),E=w==null?void 0:w.prices.find(g=>g.id===parseInt(s));let L;r==="subscription"?L=window.paypal.Buttons({style:{label:"pay"},createSubscription:(g,j)=>j.subscription.create({application_context:{shipping_preference:"NO_SHIPPING"},plan_id:E==null?void 0:E.paypal_id}),onApprove:(g,j)=>(j.redirect(`${b}/checkout/${e}/${s}/paypal/done?subscriptionId=${g.subscriptionID}&status=success`),Promise.resolve()),onError:g=>{location.href=`${b}/checkout/${e}/${s}/paypal/done?status=error`}}):L=window.paypal.Buttons({style:{label:"pay"},createOrder:(g,j)=>j.order.create({purchase_units:[{amount:{value:c??"0.00",currency_code:"USD"}}],application_context:{shipping_preference:"NO_SHIPPING"}}),onApprove:async(g,j)=>{if(!j.order)return;const Z=await j.order.capture();location.href=`${b}/purchase/${a}/paypal/done?orderId=${Z.id}&status=success`},onError:()=>{location.href=`${b}/purchase/${a}/paypal/done?status=error`}}),L.render(m.current).then(()=>{o.current=!0})},[e,s,i,f,b]),{paypalElementRef:m,stripeIsEnabled:v!=null&&u}}function Pe(){var f;const{productId:e,priceId:s}=N(),r=O(),{paypalElementRef:a}=Y({productId:e,priceId:s,type:"subscription"}),{base_url:c,billing:{stripe:i}}=_();if(r.isLoading)return t.jsx(U,{screen:!0});const n=(f=r.data)==null?void 0:f.products.find(l=>l.id===parseInt(e)),o=n==null?void 0:n.prices.find(l=>l.id===parseInt(s));return!n||!o||r.status==="error"?t.jsx(F,{to:"/pricing",replace:!0}):t.jsxs(k,{children:[t.jsxs(d.Fragment,{children:[t.jsx("h1",{className:"mb-40 text-4xl",children:t.jsx(h,{message:"Checkout"})}),i.enable?t.jsxs(d.Fragment,{children:[t.jsx(K,{productId:e,priceId:s,submitLabel:t.jsx(h,{message:"Upgrade"}),type:"subscription",returnUrl:`${c}/checkout/${e}/${s}/stripe/done?type=subscription`}),t.jsx(ge,{})]}):null,t.jsx("div",{ref:a}),t.jsx("div",{className:"mt-30 text-xs text-muted",children:t.jsx(h,{message:"You’ll be charged until you cancel your subscription. Previous charges won’t be refunded when you cancel unless it’s legally required. Your payment data is encrypted and secure. By subscribing your agree to our terms of service and privacy policy."})})]}),t.jsx(R,{})]})}function ge(){return t.jsx("div",{className:"relative my-20 text-center before:absolute before:left-0 before:top-1/2 before:h-1 before:w-full before:-translate-y-1/2 before:bg-divider",children:t.jsx("span",{className:"relative z-10 bg px-10 text-sm text-muted",children:t.jsx(h,{message:"or"})})})}function je(e,s={enabled:!0}){const r=ye(e);return T({queryKey:["file-entries",`${r}`],queryFn:()=>ve(r),enabled:!!r&&s.enabled})}function ve(e){return y.get(`file-entries/${e}/model`).then(s=>s.data)}function ye(e){if(!e)return;const s=parseInt(e);return isNaN(s)?`${e}`.split("/").pop():s}function Be(){var f,l;const{entryId:e}=N(),{paypalElementRef:s}=Y({entry_id:e,type:"capture"}),r=je(e),{base_url:a,billing:{stripe:c}}=_();if(r.isLoading)return t.jsx(U,{screen:!0});const i=(f=r.data)==null?void 0:f.fileEntry;if(!i)return t.jsx(F,{to:"/drive/shares"});const n=(l=i.users)!=null&&l.length?i.users[0]:null;if(n!=null&&n.owns_entry||(n==null?void 0:n.price)===0)return t.jsx(F,{to:"/drive/shares"});const o=(m=0,b=2)=>{if(m===0)return"0 B";const x=1024,u=["B","KB","MB","GB","TB","PB"],v=Math.floor(Math.log(m)/Math.log(x)),w=m/Math.pow(x,v);return parseFloat(w.toFixed(b))+" "+u[v]};return t.jsxs(k,{children:[t.jsxs(d.Fragment,{children:[t.jsx("h1",{className:"mb-40 text-4xl",children:t.jsx(h,{message:"Purchse from original owner"})}),c.enable?t.jsxs(d.Fragment,{children:[t.jsx(K,{submitLabel:t.jsx(h,{message:"Purchase Now"}),type:"paymentIntent",returnUrl:`${a}/purchase/${e}/stripe/done?type=order`,amount:n==null?void 0:n.price}),t.jsx(we,{})]}):null,t.jsx("div",{ref:s})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"mb-40 text-4xl",children:t.jsx(h,{message:"Summary"})}),t.jsx("table",{children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx(h,{message:"Filename"})}),t.jsx("td",{children:":"}),t.jsx("td",{children:t.jsx("strong",{children:i==null?void 0:i.name})})]}),t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx(h,{message:"Filesize"})}),t.jsx("td",{children:":"}),t.jsx("td",{children:t.jsx("strong",{children:o(i==null?void 0:i.file_size)})})]})]})}),t.jsx("div",{className:"flex items-center gap-6 mt-32",children:t.jsx("div",{className:"font-bold text-4xl",children:t.jsx(B,{value:(n==null?void 0:n.price)||0,currency:"USD"})})}),t.jsxs("div",{className:"mt-32 flex items-center justify-between gap-24 border-t pt-24 font-medium",children:[t.jsx("div",{children:t.jsx(h,{message:"Billed Today"})}),t.jsx(B,{value:(n==null?void 0:n.price)||0,currency:"USD"})]})]})]})}function we(){return t.jsx("div",{className:"relative my-20 text-center before:absolute before:left-0 before:top-1/2 before:h-1 before:w-full before:-translate-y-1/2 before:bg-divider",children:t.jsx("span",{className:"relative z-10 bg px-10 text-sm text-muted",children:t.jsx(h,{message:"or"})})})}function Fe(){const{productId:e,priceId:s,type:r,entryId:a}=N(),c=ne(),{billing:{stripe_public_key:i}}=_(),[n]=G(),o=n.get("payment_intent_client_secret"),[f,l]=d.useState(),m=d.useRef();return d.useEffect(()=>{m.current||(ie(i).then(async b=>{if(!b||!o){l(S());return}const x=b.retrievePaymentIntent(o);console.log(x),r==="subscription"&&x.then(async({paymentIntent:u})=>{(u==null?void 0:u.status)==="succeeded"?(await Se(u.id),l(S("succeeded",e,s)),window.location.href="/billing"):l(S(u==null?void 0:u.status,e,s))}),r==="order"&&x.then(async({paymentIntent:u})=>{(u==null?void 0:u.status)==="succeeded"?(await Ne(u.id,a),l(S("purchased_succeeded",a)),window.location.href="/billing"):l(S(u==null?void 0:u.status,a))})}),m.current=!0)},[i,o,s,e,a,r]),o?t.jsxs(k,{children:[t.jsx(M,{config:f}),t.jsx(R,{showBillingLine:!1})]}):(c("/"),null)}function S(e,s,r,a){switch(e){case"succeeded":return{message:p("Subscription successful!"),status:"success",buttonLabel:p("Return to site"),link:a?"/drive/shares":"/billing"};case"processing":return{message:p("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:p("Return to site"),link:a?"/drive/shares":"/billing"};case"requires_payment_method":return{message:p("Payment failed. Please try another payment method."),status:"error",buttonLabel:p("Go back"),link:a?C(a):D(s,r)};case"purchased_succeeded":return{message:p("Payment failed. Please try another payment method."),status:"error",buttonLabel:p("Go back"),link:C(a)};default:return{message:p("Something went wrong"),status:"error",buttonLabel:p("Go back"),link:a?C(a):D(s,r)}}}function C(e){return e?`/purchase/${e}`:"/"}function D(e,s){return e&&s?`/checkout/${e}/${s}`:"/"}function Se(e){return y.post("billing/stripe/store-subscription-details-locally",{payment_intent_id:e})}function Ne(e,s){return y.post("billing/stripe/store-purchase-details-locally",{payment_intent_id:e,entry_id:s})}function Re(){const{productId:e,priceId:s,entry_id:r}=N(),[a]=G(),c=d.useRef(!1),[i,n]=d.useState();return d.useEffect(()=>{const o=a.get("subscriptionId"),f=a.get("orderId"),l=a.get("status");c.current||(o&&l==="success"?ke(o).then(()=>{n(P("success",e,s)),window.location.href="/billing"}):f&&l==="success"&&r?Ee(f).then(()=>{n(P("purchase_success",r)),window.location.href="drive/shares"}):n(P(l,e,s)),c.current=!0)},[s,e,a,r]),t.jsxs(k,{children:[t.jsx(M,{config:i}),t.jsx(R,{showBillingLine:!1})]})}function P(e,s,r,a){switch(e){case"success":return{message:p("Subscription successful!"),status:"success",buttonLabel:p("Return to site"),link:"/billing"};case"purchase_success":return{message:p("Purchase successful!"),status:"success",buttonLabel:p("Return to site"),link:"drive/shares"};default:return{message:p("Something went wrong. Please try again."),status:"error",buttonLabel:p("Go back"),link:_e(s,r)}}}function _e(e,s){return e&&s?`/checkout/${e}/${s}`:"/"}function ke(e){return y.post("billing/paypal/store-subscription-details-locally",{paypal_subscription_id:e})}function Ee(e,s){return y.post("billing/paypal/store-purchase-details-locally",{paypal_order_id:e,entry_id:s})}export{Pe as Checkout,Re as CheckoutPaypalDone,Fe as CheckoutStripeDone,Be as Purchase};
//# sourceMappingURL=checkout-routes.lazy-dd404bb6.js.map
