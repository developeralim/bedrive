import{K as k,bm as A,r as o,bn as D,u as M,n as E,j as r,o as C,H as I,be as u,S as F,V as P,aK as R,aP as V,T as y,a6 as z}from"./main-09cd37c9.js";import{T as B}from"./TaskAlt-f691a085.js";var _="https://js.stripe.com/v3",W=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,N="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",q=function(){for(var e=document.querySelectorAll('script[src^="'.concat(_,'"]')),n=0;n<e.length;n++){var a=e[n];if(W.test(a.src))return a}return null},G=function(e){var n=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(_).concat(n);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(a),a},K=function(e,n){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.1.11",startTime:n})},g=null,X=function(e){return g!==null||(g=new Promise(function(n,a){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&e&&console.warn(N),window.Stripe){n(window.Stripe);return}try{var s=q();s&&e?console.warn(N):s||(s=G(e)),s.addEventListener("load",function(){window.Stripe?n(window.Stripe):a(new Error("Stripe.js not available"))}),s.addEventListener("error",function(){a(new Error("Failed to load Stripe.js"))})}catch(i){a(i);return}})),g},$=function(e,n,a){if(e===null)return null;var s=e.apply(void 0,n);return K(s,a),s},L=Promise.resolve().then(function(){return X(null)}),T=!1;L.catch(function(t){T||console.warn(t)});var H=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];T=!0;var s=Date.now();return L.then(function(i){return $(i,n,s)})};function O({type:t,productId:e,priceId:n,amount:a}){const{user:s}=k(),i=A(),c=o.useRef(!1),f=o.useRef(null),{localeCode:m}=D(),[x,w]=o.useState(null),[v,h]=o.useState(null),{branding:{site_name:b},billing:{stripe_public_key:d,stripe:{enable:S}}}=M();return o.useEffect(()=>{!S||!d||c.current||(Promise.all([H(d,{apiVersion:"2022-08-01",locale:m}),t==="setupIntent"?U():t==="subscription"?J(e,n):Q(a)]).then(([p,{clientSecret:j}])=>{if(p&&f.current){const l=p.elements({clientSecret:j,appearance:{theme:i?"night":"stripe"}});l.create("payment",{business:{name:b},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:s==null?void 0:s.email}}}).mount(f.current),w(p),h(l)}}),c.current=!0)},[e,d,S,i,m,b,t,s==null?void 0:s.email]),{stripe:x,elements:v,paymentElementRef:f,stripeIsEnabled:d!=null&&S}}function U(){return E.post("billing/stripe/create-setup-intent").then(t=>t.data)}function J(t,e){return E.post("billing/stripe/create-partial-subscription",{product_id:t,price_id:e}).then(n=>n.data)}function Q(t){return E.post("billing/stripe/create-payment-intent",{amount:t}).then(e=>e.data)}function re({productId:t,priceId:e,type:n="subscription",submitLabel:a,returnUrl:s}){const{stripe:i,elements:c,paymentElementRef:f,stripeIsEnabled:m}=O({type:n,productId:t,priceId:e}),[x,w]=o.useState(null),[v,h]=o.useState(!1),b=!m||c!=null&&i!=null,d=async S=>{var p,j;if(S.preventDefault(),!(!i||!c)){h(!0);try{let l;n==="subscription"||n==="paymentIntent"?l=await i.confirmPayment({elements:c,confirmParams:{return_url:s}}):l=await i.confirmSetup({elements:c,confirmParams:{return_url:s}}),((p=l.error)==null?void 0:p.type)!=="validation_error"&&((j=l.error)!=null&&j.message)&&w(l.error.message)}catch{}h(!1)}};return r.jsxs("form",{onSubmit:d,children:[r.jsx("div",{ref:f,className:C("min-h-[303px]",!m&&"hidden"),children:m&&r.jsx(Y,{})}),x&&!v&&r.jsx("div",{className:"mt-20 text-danger",children:x}),r.jsx(I,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:v||!b,children:a})]})}function Y(){return r.jsxs(o.Fragment,{children:[r.jsx(u,{className:"mb-20 h-30"}),r.jsx(u,{className:"mb-20 h-30"}),r.jsx(u,{className:"mb-20 h-30"}),r.jsx(u,{className:"h-30"})]})}function se({config:t}){return r.jsx(F,{initial:!1,mode:"wait",children:r.jsx("div",{className:"mt-80",children:t?r.jsxs(P.div,{className:"text-center",...R,children:[t.status==="success"?r.jsx(B,{className:"text-6xl text-positive"}):r.jsx(V,{className:"text-6xl text-danger"}),r.jsx("div",{className:"mt-30 text-2xl font-semibold",children:r.jsx(y,{...t.message})}),r.jsx(I,{variant:"flat",color:"primary",className:"mt-30 w-full",size:"md",elementType:z,to:t.link,children:r.jsx(y,{...t.buttonLabel})})]},"payment-status"):r.jsx(Z,{},"loading-skeleton")})})}function Z(){return r.jsxs(P.div,{className:"max-w-280 text-center",...R,children:[r.jsx(u,{size:"w-50 h-50",variant:"rect"}),r.jsx(u,{className:"mt-30 text-2xl"}),r.jsx(u,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{se as B,re as S,H as l};
//# sourceMappingURL=billing-redirect-message-dbd8c19a.js.map
