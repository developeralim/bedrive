import{K as A,bm as D,r as o,bn as M,u as C,n as y,j as r,o as F,H as P,be as u,S as V,V as R,aK as _,aP as z,T as N,a6 as B}from"./main-9fcde244.js";import{T as W}from"./TaskAlt-0e8720a5.js";var L="https://js.stripe.com/v3",q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,I="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",G=function(){for(var e=document.querySelectorAll('script[src^="'.concat(L,'"]')),n=0;n<e.length;n++){var a=e[n];if(q.test(a.src))return a}return null},K=function(e){var n=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(L).concat(n);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(a),a},X=function(e,n){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"2.1.11",startTime:n})},w=null,$=function(e){return w!==null||(w=new Promise(function(n,a){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe&&e&&console.warn(I),window.Stripe){n(window.Stripe);return}try{var s=G();s&&e?console.warn(I):s||(s=K(e)),s.addEventListener("load",function(){window.Stripe?n(window.Stripe):a(new Error("Stripe.js not available"))}),s.addEventListener("error",function(){a(new Error("Failed to load Stripe.js"))})}catch(i){a(i);return}})),w},H=function(e,n,a){if(e===null)return null;var s=e.apply(void 0,n);return X(s,a),s},T=Promise.resolve().then(function(){return $(null)}),k=!1;T.catch(function(t){k||console.warn(t)});var O=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];k=!0;var s=Date.now();return T.then(function(i){return H(i,n,s)})};function U({type:t,productId:e,priceId:n,amount:a}){const{user:s}=A(),i=D(),c=o.useRef(!1),l=o.useRef(null),{localeCode:h}=M(),[p,b]=o.useState(null),[E,j]=o.useState(null),{branding:{site_name:f},billing:{stripe_public_key:m,stripe:{enable:S}}}=C();return o.useEffect(()=>{!S||!m||c.current||(Promise.all([O(m,{apiVersion:"2022-08-01",locale:h}),t==="setupIntent"?J():t==="subscription"?Q(e,n):Y(a)]).then(([x,{clientSecret:g}])=>{if(x&&l.current){const v=x.elements({clientSecret:g,appearance:{theme:i?"night":"stripe"}});v.create("payment",{business:{name:f},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:s==null?void 0:s.email}}}).mount(l.current),b(x),j(v)}}),c.current=!0)},[e,m,S,i,h,f,t,s==null?void 0:s.email]),{stripe:p,elements:E,paymentElementRef:l,stripeIsEnabled:m!=null&&S}}function J(){return y.post("billing/stripe/create-setup-intent").then(t=>t.data)}function Q(t,e){return y.post("billing/stripe/create-partial-subscription",{product_id:t,price_id:e}).then(n=>n.data)}function Y(t){return alert(t),y.post("billing/stripe/create-payment-intent",{amount:t}).then(e=>e.data)}function re({productId:t,priceId:e,type:n="subscription",submitLabel:a,returnUrl:s,amount:i}){const{stripe:c,elements:l,paymentElementRef:h,stripeIsEnabled:p}=U({type:n,productId:t,priceId:e,amount:i}),[b,E]=o.useState(null),[j,f]=o.useState(!1),m=!p||l!=null&&c!=null,S=async x=>{var g,v;if(x.preventDefault(),!(!c||!l)){f(!0);try{let d;n==="subscription"||n==="paymentIntent"?d=await c.confirmPayment({elements:l,confirmParams:{return_url:s}}):d=await c.confirmSetup({elements:l,confirmParams:{return_url:s}}),((g=d.error)==null?void 0:g.type)!=="validation_error"&&((v=d.error)!=null&&v.message)&&E(d.error.message)}catch{}f(!1)}};return r.jsxs("form",{onSubmit:S,children:[r.jsx("div",{ref:h,className:F("min-h-[303px]",!p&&"hidden"),children:p&&r.jsx(Z,{})}),b&&!j&&r.jsx("div",{className:"mt-20 text-danger",children:b}),r.jsx(P,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:j||!m,children:a})]})}function Z(){return r.jsxs(o.Fragment,{children:[r.jsx(u,{className:"mb-20 h-30"}),r.jsx(u,{className:"mb-20 h-30"}),r.jsx(u,{className:"mb-20 h-30"}),r.jsx(u,{className:"h-30"})]})}function se({config:t}){return r.jsx(V,{initial:!1,mode:"wait",children:r.jsx("div",{className:"mt-80",children:t?r.jsxs(R.div,{className:"text-center",..._,children:[t.status==="success"?r.jsx(W,{className:"text-6xl text-positive"}):r.jsx(z,{className:"text-6xl text-danger"}),r.jsx("div",{className:"mt-30 text-2xl font-semibold",children:r.jsx(N,{...t.message})}),r.jsx(P,{variant:"flat",color:"primary",className:"mt-30 w-full",size:"md",elementType:B,to:t.link,children:r.jsx(N,{...t.buttonLabel})})]},"payment-status"):r.jsx(ee,{},"loading-skeleton")})})}function ee(){return r.jsxs(R.div,{className:"max-w-280 text-center",..._,children:[r.jsx(u,{size:"w-50 h-50",variant:"rect"}),r.jsx(u,{className:"mt-30 text-2xl"}),r.jsx(u,{size:"h-42",className:"mt-30"})]},"loading-skeleton")}export{se as B,re as S,O as l};
//# sourceMappingURL=billing-redirect-message-2548b06d.js.map
